(function(e){function t(t){for(var n,i,s=t[0],c=t[1],l=t[2],d=0,h=[];d<s.length;d++)i=s[d],r[i]&&h.push(r[i][0]),r[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);u&&u(t);while(h.length)h.shift()();return o.push.apply(o,l||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],n=!0,s=1;s<a.length;s++){var c=a[s];0!==r[c]&&(n=!1)}n&&(o.splice(t--,1),e=i(i.s=a[0]))}return e}var n={},r={app:0},o=[];function i(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=n,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/trickortreat/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;o.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"0fff":function(e,t,a){"use strict";var n=a("d804"),r=a.n(n);r.a},1358:function(e,t,a){"use strict";var n=a("648a"),r=a.n(n);r.a},"26e3":function(e,t,a){"use strict";var n=a("e668"),r=a.n(n);r.a},"2b51":function(e,t,a){"use strict";a.r(t);a("20d6"),a("6b54");var n=a("c665"),r=a("aa9a"),o=(a("cadf"),a("551c"),a("097d"),a("8ac7")),i=a.n(o),s=function(){function e(){Object(n["a"])(this,e),this.peer=null,this.connected=!1,this.dataChannel=null,this.onMessageCallback=null,this.onConnectedCallback=null,this.onDisconnectedCallback=null,this.instanceId=Math.random().toString(36).substr(2,9),this.isInitiator=null,this._reconnecting=!1,this._reconnectAttempts=0,this._maxReconnectAttempts=5,this._reconnectTimer=null,console.log("🔧 WebRTCService instance created:",this.instanceId),this._outQueue=[],this._flushTimer=null,this._flushIntervalMs=50,this._maxBuffered=256e3,this._latestGameState=null,this._chunkBuffers={},this._maxFrameSize=16e3}return Object(r["a"])(e,[{key:"initAsInitiator",value:function(){return this.isInitiator=!0,console.log("🔧 ["+this.instanceId+"] Initializing as initiator"),this.peer=new i.a({initiator:!0,trickle:!0,channelName:"halloween-game",config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}],iceTransportPolicy:"all",iceCandidatePoolSize:10,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},offerOptions:{offerToReceiveAudio:!1,offerToReceiveVideo:!1}}),this.setupPeerEvents(),this.peer}},{key:"initAsReceiver",value:function(){return this.isInitiator=!1,console.log("🔧 ["+this.instanceId+"] Initializing as receiver"),this.peer=new i.a({initiator:!1,trickle:!0,channelName:"halloween-game",config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}],iceTransportPolicy:"all",iceCandidatePoolSize:10,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},answerOptions:{offerToReceiveAudio:!1,offerToReceiveVideo:!1}}),this.setupPeerEvents(),this.peer}},{key:"setupPeerEvents",value:function(){var e=this;this.peer&&(this.peer.on("signal",function(t){e.onSignalCallback&&e.onSignalCallback(t)}),this.peer.on("connect",function(){console.log("✅ WebRTC connection established!"),e.connected=!0,e._reconnectAttempts=0,setTimeout(function(){try{e.peer&&e.peer._channel&&"number"===typeof e.peer._channel.bufferedAmountLowThreshold&&(e.peer._channel.bufferedAmountLowThreshold=65536,e.peer._channel.onbufferedamountlow=function(){return e._flushQueue()})}catch(e){}try{e.startKeepAlive()}catch(e){console.error("❌ Keepalive failed to start:",e)}e.onConnectedCallback&&e.onConnectedCallback(),e._startFlusher()},500)}),this.peer.on("data",function(t){e.touchKeepAlive();try{var a=t.toString(),n=JSON.parse(a);if("ping"===n.type){try{e.peer.send(JSON.stringify({type:"pong"}))}catch(e){}return}if("pong"===n.type)return;if("chunk"===n.type){var r=n.id,o=n.idx,i=n.total,s=n.payload;e._chunkBuffers[r]||(e._chunkBuffers[r]={total:i,parts:[]}),e._chunkBuffers[r].parts[o]=s;var c=e._chunkBuffers[r];if(c.parts.filter(function(e){return"string"===typeof e}).length===i){var l=c.parts.join("");delete e._chunkBuffers[r];var u=JSON.parse(l);e.onMessageCallback&&e.onMessageCallback(u)}return}e.onMessageCallback?e.onMessageCallback(n):console.warn("⚠️ ["+e.instanceId+"] No message callback registered!")}catch(t){console.error("["+e.instanceId+"] Error parsing WebRTC message:",t)}}),console.log("✅ ["+this.instanceId+"] Event listeners attached to peer"),this.peer.on("error",function(t){console.error("WebRTC error:",t),"ERR_DATA_CHANNEL"!==t.code&&"ERR_CONNECTION_FAILURE"!==t.code||(e.connected=!1,e.onDisconnectedCallback&&e.onDisconnectedCallback(),e.scheduleReconnect())}),this.peer.on("close",function(){console.log("WebRTC connection closed"),e.connected=!1,e.stopKeepAlive(),e._stopFlusher(),e.onDisconnectedCallback&&e.onDisconnectedCallback(),e.scheduleReconnect()}))}},{key:"signal",value:function(e){this.peer&&this.peer.signal(e)}},{key:"sendGameState",value:function(e){this._latestGameState=e,this._enqueue({type:"coalesced-game-state"})}},{key:"sendAction",value:function(e,t){this._enqueue({type:"action",action:e,payload:t})}},{key:"sendMessage",value:function(e){this._enqueue({type:"message",data:e})}},{key:"onSignal",value:function(e){this.onSignalCallback=e}},{key:"onMessage",value:function(e){console.log("🔧 ["+this.instanceId+"] Registering message callback"),this.onMessageCallback=e}},{key:"onConnected",value:function(e){this.onConnectedCallback=e}},{key:"onDisconnected",value:function(e){this.onDisconnectedCallback=e}},{key:"destroy",value:function(){this.peer&&(this.peer.destroy(),this.peer=null),this.connected=!1,this.stopKeepAlive(),this._reconnecting=!1,this._reconnectAttempts=0,this._reconnectTimer&&(clearTimeout(this._reconnectTimer),this._reconnectTimer=null),this._stopFlusher(),this._outQueue=[],this._latestGameState=null}},{key:"isConnected",value:function(){return this.connected}},{key:"startKeepAlive",value:function(){var e=this;this._keepAliveTimer||(this._lastPongAt=Date.now(),this._keepAliveTimer=setInterval(function(){if(e.peer&&!e.peer.destroyed){try{e.peer.send(JSON.stringify({type:"ping"}))}catch(e){console.warn("⚠️ Failed to send keepalive ping:",e)}Date.now()-(e._lastPongAt||0)>3e4&&(console.warn("⚠️ No keepalive response for 30s, connection may be lost"),e.onDisconnectedCallback&&e.onDisconnectedCallback())}},3e3))}},{key:"touchKeepAlive",value:function(){this._lastPongAt=Date.now()}},{key:"stopKeepAlive",value:function(){this._keepAliveTimer&&(clearInterval(this._keepAliveTimer),this._keepAliveTimer=null)}},{key:"scheduleReconnect",value:function(){var e=this;if(!this._reconnecting&&!(this._reconnectAttempts>=this._maxReconnectAttempts)){this._reconnecting=!0;var t=Math.min(16e3,1e3*Math.pow(2,this._reconnectAttempts));this._reconnectTimer=setTimeout(function(){e._reconnecting=!1,e._reconnectAttempts+=1,e.reconnect()},t)}}},{key:"reconnect",value:function(){if(this.peer){try{this.peer.destroy()}catch(e){}this.peer=null}if(this.connected=!1,!0===this.isInitiator)this.initAsInitiator();else{if(!1!==this.isInitiator)return;this.initAsReceiver()}}},{key:"_enqueue",value:function(e){if("coalesced-game-state"===e.type){var t=this._outQueue.some(function(e){return"coalesced-game-state"===e.type});t||this._outQueue.push(e)}else this._outQueue.push(e);this._flushQueue(),this._startFlusher()}},{key:"_startFlusher",value:function(){var e=this;this._flushTimer||(this._flushTimer=setInterval(function(){return e._flushQueue()},this._flushIntervalMs))}},{key:"_stopFlusher",value:function(){this._flushTimer&&(clearInterval(this._flushTimer),this._flushTimer=null)}},{key:"_flushQueue",value:function(){if(this.peer&&this.connected){var e=this.peer._channel;if(e&&"open"===e.readyState&&!("number"===typeof e.bufferedAmount&&e.bufferedAmount>this._maxBuffered)){var t=this._outQueue.findIndex(function(e){return"coalesced-game-state"===e.type});if(-1!==t){var a=this._latestGameState;if(a){var n={type:"gameState",data:a};this._sendJson(n)}this._outQueue.splice(t,1)}var r=0,o=5;while(this._outQueue.length>0&&r<o){var i=this._outQueue.shift();if("coalesced-game-state"!==i.type&&(this._sendJson(i),r++),"number"===typeof e.bufferedAmount&&e.bufferedAmount>this._maxBuffered)break}}}}},{key:"_sendJson",value:function(e){try{var t=JSON.stringify(e);if(t.length<=this._maxFrameSize)this.peer.send(t);else for(var a=Math.random().toString(36).slice(2),n=Math.ceil(t.length/this._maxFrameSize),r=0;r<n;r++){var o=t.slice(r*this._maxFrameSize,(r+1)*this._maxFrameSize);this.peer.send(JSON.stringify({type:"chunk",id:a,idx:r,total:n,payload:o}))}}catch(t){this._outQueue.unshift(e)}}}]),e}();t["default"]=new s},3587:function(e,t,a){},"4d5c":function(e,t,a){"use strict";var n=a("e614"),r=a.n(n);r.a},"4db1":function(e,t,a){"use strict";var n=a("8456"),r=a.n(n);r.a},"53bd":function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);a("cadf"),a("551c"),a("097d");var n=a("2b0e"),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("GameThree"),"lobby"===e.mode?a("Lobby"):e._e(),"play"===e.mode?a("Controls"):e._e(),"levelSelect"===e.mode?a("LevelSelect"):e._e(),"levelWin"===e.mode?a("LevelWin"):e._e(),"characterSelect"===e.mode?a("CharacterSelect"):e._e(),"mapEditor"===e.mode?a("MapEditor"):e._e(),a("InteractionOverlay"),e.showQRButton?a("div",{staticClass:"qr-code-button",on:{click:function(t){return t.stopPropagation(),e.toggleQRCode(t)}}},[a("img",{staticClass:"qr-icon",attrs:{src:e.baseUrl+"qricon.png",alt:"QR Code"}})]):e._e(),e.showQR?a("div",{staticClass:"qr-modal",on:{click:e.toggleQRCode}},[a("div",{staticClass:"qr-content",on:{click:function(e){e.stopPropagation()}}},[a("div",{staticClass:"qr-placeholder"},[a("img",{attrs:{src:e.baseUrl+"qrcode.png",alt:"QR Code"}})]),a("button",{staticClass:"close-qr",on:{click:e.toggleQRCode}},[e._v("Close")])])]):e._e(),"lobby"===e.mode?a("DirectionsHelper"):e._e()],1)},o=[],i=a("c93e"),s=(a("96cf"),a("3040")),c=a("2f62"),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"controls"},[a("div",{staticClass:"score-holder"},[a("score")],1),e.isMultiplayer?a("div",{staticClass:"role-indicator",class:e.playerRole},[e.isPlayer?a("span",[e._v("🎮 Player")]):a("span",[e._v("👁️ Guide")])]):e._e(),a("div",{staticClass:"menu-toggle"},[a("button",{staticClass:"control",attrs:{type:"button"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.openMenu(t)},touchstart:function(t){return t.stopPropagation(),t.preventDefault(),e.openMenu(t)}}},[a("svg",{attrs:{viewBox:"0 0 32 32"}},[a("path",{attrs:{d:"M23.374,8.626H8.626 c-0.393,0-0.712,0.319-0.712,0.712v1.508c0,0.393,0.319,0.712,0.712,0.712h14.747c0.393,0,0.712-0.319,0.712-0.712V9.338 C24.086,8.945,23.767,8.626,23.374,8.626z M23.374,14.534H8.626c-0.393,0-0.712,0.319-0.712,0.712v1.508 c0,0.393,0.319,0.712,0.712,0.712h14.747c0.393,0,0.712-0.319,0.712-0.712v-1.508C24.086,14.853,23.767,14.534,23.374,14.534z M23.374,20.441H8.626c-0.393,0-0.712,0.319-0.712,0.712v1.508c0,0.393,0.319,0.712,0.712,0.712h14.747 c0.393,0,0.712-0.319,0.712-0.712v-1.508C24.086,20.76,23.767,20.441,23.374,20.441z"}})])])]),e.isMultiplayer&&!e.isPlayer||!e.canTrickOrTreat?e._e():a("div",{staticClass:"trick-or-treat-container"},[a("button",{staticClass:"trick-or-treat-button",attrs:{type:"button"},on:{touchstart:function(t){t.preventDefault(),t.stopPropagation(),e.$store.dispatch("trickOrTreat")},mousedown:function(t){e.$store.dispatch("trickOrTreat")}}},[e._v("\n      🎃 Trick-Or-Treat! 🍬\n    ")])]),!e.isMultiplayer||e.isPlayer?a("div",{staticClass:"arrows"},[a("div",{staticClass:"relative"},e._l(e.$options.buttons,function(t){return a("div",{key:t.action,staticClass:"control-spacer",class:t.direction},[a("button",{staticClass:"control",attrs:{type:"button"},on:{touchstart:function(a){a.preventDefault(),a.stopPropagation(),e.$store.dispatch(t.action)},mousedown:function(a){e.$store.dispatch(t.action)}}},[a("img",{staticClass:"control-icon",attrs:{src:e.baseUrl+t.image,alt:t.direction}})])])}))]):e.isGuide?a("div",{staticClass:"guide-info"},[a("p",[e._v("👁️ 上から見て、パートナーをナビゲートするのを手伝ってください！")])]):e._e()])},u=[],d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"score"},[a("div",[a("svg",{staticClass:"icon",attrs:{viewBox:"0 0 32 32"}},[a("g",{staticClass:"candy"},[a("path",{staticStyle:{fill:"#FEEB39"},attrs:{d:"M25.308,9.152c-0.04-0.38-0.08-0.759-0.12-1.139c0.073-0.596-0.1-1.094-0.476-1.579 c-0.573-0.74-1.071-1.539-1.606-2.321c0.015-0.008-0.035,0.002-0.057,0.031c-1.005,1.357-2.011,2.712-3.003,4.079 c-0.069,0.095-0.026,0.27-0.035,0.408c0,0-0.001,0-0.001,0.001c-0.377,0.234-0.665,0.52-0.605,1.014l0.009,0.001 c-0.032,0.049-0.064,0.098-0.096,0.146c-0.012,0.255-0.024,0.51-0.035,0.765c-0.124-0.001-0.247-0.001-0.371-0.002l0,0 c-0.056-0.008-0.111-0.016-0.167-0.023c-1.397-0.308-2.789-0.977-4.199-0.046c-0.475,0.191-0.951,0.383-1.426,0.574 c-0.029-0.016-0.053-0.01-0.07,0.019c-0.051,0.039-0.101,0.077-0.152,0.116c0,0,0.007-0.021,0.007-0.021 c-0.232,0.202-0.501,0.375-0.688,0.612c-0.416,0.525-0.771,1.098-1.188,1.621c-0.355,0.445-0.579,0.911-0.512,1.49 c-0.032,0.228-0.093,0.457-0.089,0.685c0.015,0.801-0.391,1.609,0.036,2.412c0.022,0.041-0.225,0.224-0.346,0.34 c-0.171,0.009-0.342,0.019-0.513,0.028C8.997,18.267,8.45,18.408,7.9,18.693c-1.053,0.545-2.147,1.012-3.199,1.558 c-0.461,0.239-0.862,0.593-1.29,0.895c-0.058,0.002-0.116,0.004-0.174,0.005c0.301,0.336,0.602,0.671,0.903,1.007l1.31,1.003 c0.632,0.282,1.27,0.552,1.892,0.854c0.211,0.103,0.458,0.25,0.556,0.444c0.208,0.412,0.329,0.869,0.485,1.307 c0.288,0.606,0.571,1.215,0.869,1.816c0.06,0.122,0.179,0.306,0.271,0.306c0.531-0.001,1.063-0.048,1.594-0.08l0,0 c0.03-0.054,0.059-0.107,0.089-0.161l0.068-0.232c0.086-0.21,0.171-0.42,0.257-0.63c0.254-0.301,0.507-0.601,0.761-0.902 c0.206-0.228,0.412-0.456,0.618-0.684l0.045,0.001L13,25.201c0.478-0.783,1.396-1.319,1.339-2.4 c0.252,0.033,0.504,0.065,0.756,0.098c0.126,0.016,0.252,0.033,0.378,0.049c1.072,0.305,2.062,0.269,3.178-0.114 c1.732-0.594,2.85-1.705,3.703-3.217c0.059-0.104,0.17-0.178,0.257-0.265c0.035-0.341,0.071-0.683,0.106-1.024l0.146-1.131 c-0.034-0.554-0.067-1.108-0.101-1.662c0.903,0.072,1.507-0.506,2.153-0.992l1.019-0.775c0.228-0.121,0.455-0.243,0.683-0.364 c0.069-0.018,0.137-0.036,0.206-0.055c0.054-0.014,0.11-0.024,0.168-0.033c0.229-0.034,0.473-0.038,0.667-0.138 c0.146-0.075,0.263-0.203,0.324-0.439c0.236-0.364,0.473-0.728,0.779-1.201C27.596,10.732,26.452,9.942,25.308,9.152z"}}),a("path",{staticStyle:{fill:"#FB691A"},attrs:{d:"M4.14,22.158c-0.301-0.336-0.602-0.671-0.903-1.007c0.058-0.002,0.116-0.004,0.174-0.005 c0.334-0.015,0.677,0.01,1.002-0.053c1.109-0.215,2.147-0.236,2.874,0.839c0.404,0.718,0.808,1.436,1.212,2.155 c0.107,0.252,0.23,0.498,0.318,0.757c0.272,0.796,0.605,1.53,1.543,1.729c0.222,0.359,0.445,0.718,0.667,1.077 c0.03,0.053,0.059,0.107,0.089,0.16c-0.531,0.032-1.063,0.079-1.594,0.08c-0.092,0-0.21-0.184-0.271-0.306 c-0.298-0.601-0.581-1.21-0.869-1.816c-0.157-0.438-0.277-0.895-0.485-1.307c-0.098-0.194-0.345-0.342-0.556-0.444 c-0.622-0.302-1.26-0.572-1.892-0.854C5.013,22.827,4.577,22.493,4.14,22.158z"}}),a("path",{staticStyle:{fill:"#FDA728"},attrs:{d:"M23.865,13.082c-0.79-0.322-1.139-1.103-1.338-1.887c-0.398-1.56-0.584-1.663-2.06-0.962 c-0.342,0.162-0.692,0.306-1.039,0.459c-0.002,0.042,0,0.083,0.006,0.125c0.671,0.607,1.441,1.138,1.984,1.844 c0.456,0.593,0.648,1.389,0.957,2.095c0.13,0.259,0.259,0.518,0.389,0.776c0.903,0.072,1.507-0.506,2.153-0.992 C24.919,13.799,24.577,13.373,23.865,13.082z M13.148,21.162c-0.522-0.245-0.979-0.605-0.959-1.209 c0.021-0.644-0.31-0.958-0.797-1.22c-0.407,0.426-0.803,0.864-1.225,1.275c-0.273,0.265-0.351,0.511-0.094,0.826 c0.079,0.097,0.135,0.217,0.18,0.336c0.35,0.929,0.993,1.362,2.005,1.272c0.2-0.018,0.419,0.182,0.629,0.282 c-0.157,0.241-0.314,0.482-0.471,0.722c-0.003,0.127-0.007,0.253-0.01,0.38c0.168,0.459,0.336,0.917,0.504,1.376l0.045,0.001 L13,25.201c0.478-0.783,1.396-1.319,1.339-2.4c-0.214-0.378-0.407-0.77-0.651-1.128C13.551,21.473,13.331,21.33,13.148,21.162z"}}),a("path",{staticStyle:{fill:"#FDDE36"},attrs:{d:"M13.712,17.365c-0.084,0.061-0.149,0.148-0.225,0.221c-0.518,0.499-0.722,0.453-0.952-0.228 c-0.06-0.178-0.086-0.367-0.128-0.551c-0.073-0.07-0.197-0.131-0.211-0.211c-0.305-1.724-0.247-3.383,1.227-4.601 c0.344-0.284,0.927-0.278,1.401-0.405c-0.04-0.171-0.079-0.342-0.119-0.513c-0.528-0.005-1.055-0.01-1.583-0.015 c-0.029-0.016-0.053-0.01-0.07,0.019c-0.051,0.039-0.101,0.077-0.152,0.116c0,0,0.007-0.021,0.007-0.021 c-0.217,0.379-0.396,0.787-0.659,1.13c-0.624,0.811-1.279,1.594-1.135,2.722c0.006,0.05-0.051,0.108-0.105,0.214 c-0.173-0.122-0.331-0.232-0.488-0.343c-0.031,0.228-0.093,0.457-0.089,0.685c0.015,0.801-0.391,1.609,0.036,2.412 c0.022,0.041-0.225,0.224-0.346,0.34c-0.332,0.524-0.669,1.045-0.991,1.575c-0.114,0.188-0.192,0.398-0.286,0.599 c0.438-0.486,0.848-1,1.323-1.446c0.271-0.254,0.647-0.397,0.975-0.591c0.085,0.087,0.169,0.173,0.254,0.26 c0.486,0.262,0.817,0.576,0.797,1.22c-0.019,0.604,0.437,0.964,0.959,1.209c0.35-0.345,0.7-0.69,1.05-1.035 c-0.953-0.925-0.925-0.884,0.232-1.672c0.62-0.422,1.127-1.012,1.685-1.527c-0.128-0.337-0.256-0.674-0.384-1.011 C15.058,16.399,14.383,16.879,13.712,17.365z M25.949,11.743c-0.656,0.14-0.908-0.227-1.105-0.668 c-0.236-0.529-0.478-1.084-0.555-1.65c-0.169-1.243-0.551-1.552-1.734-1.349c-0.563,0.096-1.151,0.045-1.727,0.061 c-0.272,0.165-0.543,0.33-0.816,0.495c-0.377,0.234-0.665,0.52-0.605,1.014l0.4,0.023c0.001-0.042,0.001-0.083,0.002-0.125 c0.14-0.494,0.502-0.693,0.979-0.764c0.477-0.071,0.956-0.146,1.424-0.258c1.041-0.248,1.497,0.034,1.526,1.112 c0.018,0.683,0.275,1.215,0.651,1.74c0.303,0.424,0.607,0.755,1.212,0.761c0.437,0.004,0.767,0.313,0.843,0.808 c0.024,0.158,0.115,0.306,0.175,0.459c0.069-0.018,0.137-0.036,0.206-0.055c0.021-0.167,0.044-0.334,0.064-0.501 C26.952,12.313,26.451,11.636,25.949,11.743z M10.19,23.581c-0.714,0.036-1.105-0.301-1.302-0.947 c-0.049-0.161-0.079-0.365-0.192-0.463c-0.515-0.444-0.481-0.906-0.111-1.407c-0.165,0.121-0.417,0.209-0.477,0.369 c-0.115,0.309-0.287,0.811-0.145,0.964c0.585,0.63,0.599,1.741,1.637,1.976c0.101,0.023,0.211,0.006,0.317,0.007 c0.233,0.001,0.466-0.002,0.699,0.001c0.773,0.01,0.844,0.114,0.523,0.8c-0.06,0.128-0.171,0.232-0.259,0.347 c-0.044,0.126-0.088,0.252-0.132,0.378c0.175,0.603,0.349,1.206,0.524,1.809c0.086-0.21,0.171-0.42,0.257-0.63 c-0.414-1.053-0.15-2.072,0.324-3.131C11.191,23.622,10.688,23.556,10.19,23.581z M11.117,27.809 c0.03-0.054,0.059-0.107,0.089-0.161c-0.059,0-0.119,0.001-0.178,0.001C11.058,27.703,11.088,27.756,11.117,27.809z M17.773,11.077 c0.001,0.128,0.001,0.255,0.002,0.383c0.385,0.089,0.858,0.067,1.138,0.288c0.652,0.516,1.232,1.13,1.787,1.754 c0.091,0.103-0.018,0.547-0.169,0.675c-0.62,0.528-1.288,1-1.949,1.478c-0.11,0.08-0.273,0.087-0.411,0.128 c0.164,0.555,0.329,1.11,0.493,1.666c0.249-0.102,0.528-0.162,0.741-0.315c0.629-0.449,1.133-1.1,2.006-1.129 c0.093-0.003,0.272-0.216,0.254-0.294c-0.182-0.753-0.221-1.623-0.642-2.218C20.227,12.37,19.356,11.203,17.773,11.077z"}}),a("path",{staticStyle:{fill:"#FEFE91"},attrs:{d:"M15.214,13.926c-0.044-0.057-0.088-0.114-0.132-0.171c-0.093-0.599-0.185-1.197-0.278-1.796 c0.016-0.034,0.03-0.069,0.041-0.105c0.937-0.446,1.894-0.666,2.906-0.253c0.004,0.163,0.009,0.326,0.013,0.489 c-0.478,0.298-0.972,0.575-1.43,0.902C15.94,13.273,15.586,13.612,15.214,13.926z"}}),a("path",{staticStyle:{fill:"#FEC32F"},attrs:{d:"M24.529,12.42c-0.078,0.003-0.189-0.105-0.235-0.188c-0.402-0.733-0.969-1.362-1.086-2.263 c-0.132-1.02-0.455-1.14-1.42-0.861c-0.647,0.187-1.318,0.293-1.978,0.435c-0.001,0.042-0.002,0.083-0.002,0.125 c-0.133,0.306-0.266,0.612-0.399,0.918c0.005,0.035,0.011,0.07,0.019,0.105c0.346-0.152,0.697-0.296,1.039-0.459 c1.476-0.702,1.662-0.599,2.06,0.962c0.2,0.784,0.549,1.565,1.338,1.887c0.712,0.291,1.054,0.717,1.052,1.459 c0.34-0.258,0.68-0.516,1.019-0.775C25.686,13.09,25.465,12.388,24.529,12.42z M11.965,24.923c0.08,0.328,0.216,0.641,0.327,0.961 c0.206-0.228,0.412-0.456,0.618-0.684c-0.168-0.459-0.336-0.917-0.503-1.376C11.849,24.025,11.853,24.466,11.965,24.923z M15.981,21.27c0.128-0.132,0.352-0.253,0.368-0.397c0.075-0.669,0.093-1.344,0.131-2.016c-0.719,0.425-1.439,0.85-2.158,1.275 C14.875,20.511,15.428,20.89,15.981,21.27z M12.887,22.723c-0.21-0.099-0.429-0.299-0.629-0.282 c-1.013,0.09-1.655-0.344-2.005-1.272c-0.045-0.118-0.101-0.239-0.18-0.336c-0.257-0.314-0.178-0.561,0.094-0.826 c0.423-0.41,0.818-0.848,1.225-1.275c-0.085-0.087-0.169-0.173-0.254-0.26c-0.387,0.408-0.782,0.809-1.16,1.226 c-0.355,0.391-0.904,0.763-0.976,1.207c-0.068,0.415,0.422,0.899,0.587,1.379c0.255,0.741,0.811,0.876,1.49,0.915 c0.449,0.026,0.892,0.16,1.337,0.245C12.573,23.204,12.73,22.964,12.887,22.723z"}}),a("path",{staticStyle:{fill:"#FECF32"},attrs:{d:"M26.444,12.943c-0.075-0.495-0.406-0.804-0.843-0.808c-0.605-0.006-0.908-0.337-1.212-0.761 c-0.375-0.524-0.632-1.057-0.651-1.74c-0.029-1.078-0.485-1.36-1.526-1.112c-0.469,0.112-0.947,0.187-1.424,0.258 c-0.477,0.071-0.839,0.27-0.979,0.764c0.66-0.142,1.331-0.248,1.978-0.435c0.965-0.279,1.288-0.159,1.42,0.861 c0.117,0.9,0.684,1.53,1.086,2.263c0.046,0.084,0.157,0.191,0.235,0.188c0.936-0.032,1.157,0.67,1.407,1.346 c0.228-0.121,0.455-0.243,0.683-0.364C26.559,13.249,26.468,13.101,26.444,12.943z M19.407,9.646l0.009,0.001 c0.001-0.001,0.001-0.002,0.002-0.003L19.407,9.646z M19.807,9.669l-0.391-0.022c-0.032,0.049-0.064,0.098-0.096,0.146 c-0.012,0.255-0.024,0.51-0.035,0.765c0.042,0.01,0.083,0.019,0.124,0.029C19.542,10.281,19.675,9.975,19.807,9.669z M9.589,22.285 c-0.166-0.48-0.655-0.964-0.587-1.379c0.073-0.444,0.621-0.816,0.976-1.207c0.378-0.416,0.773-0.818,1.16-1.226 c-0.329,0.193-0.704,0.336-0.975,0.591c-0.475,0.446-0.886,0.96-1.323,1.446c-0.085,0.085-0.17,0.17-0.255,0.256 c-0.37,0.501-0.404,0.963,0.111,1.407c0.113,0.098,0.143,0.302,0.192,0.463c0.197,0.645,0.587,0.983,1.302,0.947 c0.498-0.026,1.002,0.041,1.666,0.074c-0.474,1.059-0.738,2.078-0.324,3.131c0.254-0.301,0.507-0.601,0.761-0.902 c-0.111-0.32-0.247-0.634-0.327-0.961c-0.111-0.457-0.116-0.898,0.441-1.099c0.003-0.127,0.007-0.253,0.01-0.38 c-0.445-0.086-0.888-0.219-1.337-0.245C10.4,23.161,9.844,23.026,9.589,22.285z M18.913,11.748c-0.28-0.222-0.753-0.2-1.138-0.288 c-0.008,0.047-0.015,0.094-0.023,0.141c0.004,0.163,0.009,0.326,0.013,0.489c0.135,1.231,0.27,2.462,0.405,3.693 c0.138-0.041,0.301-0.048,0.411-0.128c0.661-0.478,1.329-0.951,1.949-1.478c0.151-0.128,0.261-0.572,0.169-0.675 C20.145,12.878,19.565,12.264,18.913,11.748z M14.43,18.455c-1.157,0.788-1.185,0.748-0.232,1.672 c0.041,0.002,0.083,0.003,0.124,0.004c0.719-0.425,1.439-0.85,2.158-1.275c-0.122-0.643-0.244-1.285-0.365-1.928 C15.557,17.443,15.05,18.032,14.43,18.455z M12.407,16.807c0.002-0.168,0.005-0.337,0.007-0.505 c-0.148-1.598,0.613-2.833,1.617-3.952c0.18-0.2,0.512-0.264,0.774-0.39c0.016-0.034,0.029-0.069,0.041-0.105 c-0.008-0.088-0.015-0.176-0.023-0.264c-0.473,0.127-1.057,0.121-1.401,0.405c-1.473,1.219-1.532,2.877-1.227,4.601 C12.21,16.676,12.334,16.737,12.407,16.807z"}}),a("path",{staticStyle:{fill:"#FDFD3E"},attrs:{d:"M22.375,14.756c-0.047,0.158-0.165,0.336-0.129,0.472c0.288,1.088-0.555,1.738-0.964,2.553 c-0.051,0.101-0.233,0.248-0.277,0.225c-0.751-0.396-1.259,0.286-1.888,0.406c-0.059,0.011-0.123,0.002-0.275,0.002 c-0.059-0.321-0.118-0.644-0.177-0.966c-0.164-0.555-0.329-1.11-0.493-1.666c-0.135-1.231-0.27-2.462-0.405-3.693 c-0.478,0.298-0.972,0.575-1.43,0.902c-0.395,0.282-0.749,0.621-1.121,0.935c0.172,0.664,0.344,1.327,0.517,1.991 c0.128,0.337,0.256,0.674,0.384,1.011c0.122,0.643,0.243,1.286,0.365,1.928c-0.038,0.673-0.056,1.348-0.131,2.016 c-0.016,0.144-0.24,0.266-0.368,0.397c-0.098,0.194-0.145,0.474-0.303,0.567c-0.528,0.312-0.642,0.646-0.205,1.11 c1.072,0.305,2.062,0.269,3.178-0.114c1.732-0.594,2.85-1.705,3.703-3.217c0.059-0.104,0.17-0.178,0.257-0.265 c0.035-0.341,0.071-0.683,0.106-1.024l0.146-1.131l-0.101-1.662C22.634,15.274,22.504,15.015,22.375,14.756z M7.9,18.693 c-1.053,0.545-2.147,1.012-3.199,1.558c-0.461,0.239-0.862,0.593-1.29,0.895c0.334-0.015,0.677,0.01,1.002-0.053 c1.109-0.215,2.147-0.236,2.874,0.839l2.318-3.569C8.997,18.267,8.45,18.408,7.9,18.693z M23.107,4.113 c0.015-0.008-0.035,0.002-0.057,0.031c-1.005,1.357-2.011,2.712-3.003,4.079c-0.069,0.095-0.026,0.27-0.035,0.409 c0.272-0.165,0.543-0.33,0.815-0.495c0.343-0.253,0.653-0.601,1.038-0.735c0.546-0.191,1.155-0.195,1.722-0.336 c0.523-0.13,0.902-0.061,1.156,0.465c0.091,0.189,0.293,0.323,0.445,0.483c0.073-0.596-0.1-1.094-0.476-1.579 C24.14,5.694,23.642,4.895,23.107,4.113z M14.823,11.59c0.008,0.088,0.015,0.176,0.023,0.264c0.937-0.446,1.894-0.666,2.906-0.253 c0.008-0.047,0.015-0.094,0.023-0.141c-0.001-0.128-0.002-0.255-0.002-0.383c-0.019-0.355,0.089-0.549,0.501-0.468 c0.147,0.029,0.315-0.048,0.473-0.076c-1.397-0.308-2.789-0.977-4.199-0.046c0.052,0.196,0.104,0.393,0.157,0.589 C14.744,11.247,14.783,11.418,14.823,11.59z M25.308,9.152c0.103,0.516,0.167,1.044,0.321,1.544 c0.13,0.422,0.459,0.603,0.907,0.407c0.52-0.227,0.888-0.014,1.094,0.444c0.168,0.374,0.239,0.792,0.353,1.191 c0.236-0.364,0.473-0.728,0.779-1.201C27.596,10.732,26.452,9.942,25.308,9.152z M19.428,10.692 c-0.008-0.035-0.014-0.07-0.019-0.105c-0.041-0.01-0.083-0.019-0.124-0.029c-0.124-0.001-0.247-0.001-0.371-0.002 c0.173,0.087,0.347,0.174,0.52,0.261C19.428,10.776,19.426,10.734,19.428,10.692z M10.565,24.465 c-0.693-0.1-1.378-0.25-2.066-0.378c0.107,0.252,0.23,0.498,0.318,0.757c0.272,0.796,0.605,1.53,1.543,1.729 c0.13-0.322,0.26-0.643,0.389-0.965c0.044-0.126,0.088-0.252,0.132-0.378C10.866,24.939,11.147,24.549,10.565,24.465z M14.031,12.349c-1.004,1.119-1.766,2.354-1.617,3.952c0.249-0.286,0.545-0.545,0.739-0.865c0.469-0.773,1.098-1.338,1.93-1.682 c-0.093-0.599-0.185-1.197-0.278-1.796C14.543,12.085,14.211,12.149,14.031,12.349z"}})])]),a("span",[e._v(": "+e._s(e.$store.getters.score))])])])},h=[],p=(a("26e3"),a("2877")),m={},f=Object(p["a"])(m,d,h,!1,null,"9b1f1d38",null);f.options.__file="Score.vue";var v=f.exports,y={ArrowUp:"forward",ArrowDown:"forward",ArrowLeft:"turnLeftAction",ArrowRight:"turnRightAction",w:"forward",s:"forward",a:"turnLeftAction",d:"turnRightAction",W:"forward",S:"forward",A:"turnLeftAction",D:"turnRightAction",8:"forward",2:"forward",5:"forward",4:"turnLeftAction",6:"turnRightAction"," ":"forward"},g={name:"Controls",components:{Score:v},methods:{openMenu:function(e){e&&(e.stopPropagation(),e.preventDefault()),this.$store.dispatch("mode","levelSelect")},handleKeydown:function(e){if(!this.isMultiplayer||this.isPlayer){var t=y[e.key];t&&(e.preventDefault(),e.stopPropagation(),this.$store.dispatch(t))}}},computed:Object(i["a"])({},Object(c["b"])(["isMultiplayer","isPlayer","isGuide","playerRole","canTrickOrTreat"]),{baseUrl:function(){return"/trickortreat/"}}),buttons:[{direction:"up",action:"forward",image:"gostraight.png"},{direction:"left",action:"turnLeftAction",image:"turnleft.png"},{direction:"right",action:"turnRightAction",image:"turnright.png"},{direction:"down",action:"shortForwardAction",image:"gostraightlittle.png"}],mounted:function(){window.document.body.addEventListener("keydown",this.handleKeydown)},destroyed:function(){window.document.body.removeEventListener("keydown",this.handleKeydown)}},b=g,x=(a("4db1"),Object(p["a"])(b,l,u,!1,null,"4cb7a02e",null));x.options.__file="Controls.vue";var C=x.exports,w=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"level-select-overlay",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.closeMenu(t)}}},[a("div",{staticClass:"level-select",on:{click:function(e){e.stopPropagation()}}},[a("h1",[e._v("🎃 Trick or Treat 🍬")]),a("div",{staticClass:"close"},[a("button",{staticClass:"control",attrs:{type:"button"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.closeMenu(t)},touchstart:function(t){return t.stopPropagation(),t.preventDefault(),e.closeMenu(t)}}},[a("svg",{attrs:{viewBox:"0 0 32 32"}},[a("path",{attrs:{d:"M25.749,21.72c-1.507-1.994-3.014-3.988-4.521-5.982 c0.666-0.794,1.331-1.588,1.997-2.382c1.294-1.544,2.674-3.404,2.246-5.372c-0.059-0.272-0.159-0.548-0.359-0.742 c-0.704-0.687-1.457-1.33-2.444-1.6c-0.167-0.046-0.34-0.088-0.511-0.058c-0.21,0.037-0.384,0.179-0.547,0.317 c-1.615,1.374-3.072,2.924-4.396,4.58c-0.967-1.217-1.977-2.4-3.11-3.467c-0.741-0.697-1.936-2.02-2.955-2.275 C9.874,4.419,8.777,5.666,8.209,6.622c-0.866,1.456-1.339,2.4-0.244,3.887c1.41,1.915,2.838,3.824,4.308,5.696 c-2.26,2.054-4.247,4.387-6.227,6.712c-0.101,0.119-0.207,0.25-0.215,0.405c-0.01,0.196,0.138,0.361,0.278,0.5 c1.071,1.065,2.232,2.04,3.466,2.911c0.356,0.251,0.734,0.501,1.165,0.563c1.225,0.178,2.079-1.117,2.759-2.151 c0.577-0.877,1.253-1.684,1.928-2.489c0.386-0.461,0.772-0.921,1.158-1.382c0.795,0.852,1.596,1.698,2.447,2.497 c0.91,0.855,1.865,1.686,2.549,2.731c0.115,0.176,0.23,0.365,0.414,0.468c0.253,0.141,0.569,0.082,0.841-0.017 c1.515-0.552,2.411-2.089,3.1-3.547c0.128-0.27,0.256-0.557,0.228-0.855C26.135,22.239,25.939,21.97,25.749,21.72z"}})])])]),a("div",{staticClass:"controls"},[a("div",{staticClass:"directions-section"},[a("h3",[e._v("方向の伝え方")]),a("div",{staticClass:"direction-item"},[a("img",{staticClass:"icon",attrs:{src:e.baseUrl+"gostraight.png",alt:"Go straight"}}),e._m(0)]),a("div",{staticClass:"direction-item"},[a("img",{staticClass:"icon",attrs:{src:e.baseUrl+"gostraightlittle.png",alt:"Go straight a little"}}),e._m(1)]),a("div",{staticClass:"direction-item"},[a("img",{staticClass:"icon",attrs:{src:e.baseUrl+"turnright.png",alt:"Turn right"}}),e._m(2)]),a("div",{staticClass:"direction-item"},[a("img",{staticClass:"icon",attrs:{src:e.baseUrl+"turnleft.png",alt:"Turn left"}}),e._m(3)]),a("div",{staticClass:"direction-item"},[a("img",{staticClass:"icon",attrs:{src:e.baseUrl+"seeleft.png",alt:"See left"}}),e._m(4)]),a("div",{staticClass:"direction-item"},[a("img",{staticClass:"icon",attrs:{src:e.baseUrl+"seeright.png",alt:"See right"}}),e._m(5)])]),a("button",{staticClass:"control quit-btn",attrs:{type:"button"},on:{mousedown:e.quitGame,touchstart:function(t){return t.preventDefault(),t.stopPropagation(),e.quitGame(t)}}},[e._v("Quit Game")])])])])},_=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"text"},[e._v("Go straight for "),a("strong",[e._v("〇 block(s)")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"text"},[e._v("Go straight for "),a("strong",[e._v("a little bit")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"text"},[a("strong",[e._v("Turn right")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"text"},[a("strong",[e._v("Turn left")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"text"},[e._v("You can see it on your "),a("strong",[e._v("left")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"text"},[e._v("You can see it on your "),a("strong",[e._v("right")])])}],M={computed:{baseUrl:function(){return"/trickortreat/"}},methods:{closeMenu:function(e){e&&(e.stopPropagation(),e.preventDefault()),this.$store.dispatch("mode",this.$store.getters.modePrevious)},quitGame:function(){this.$store.dispatch("resetMultiplayer"),this.$store.dispatch("mode","lobby"),this.$store.dispatch("modePrevious","lobby")}}},R=M,k=(a("9cfc"),Object(p["a"])(R,w,_,!1,null,"759747e6",null));k.options.__file="LevelSelect.vue";var I=k.exports,P=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"level-win"},[a("h1",[e._v(e._s(e.winTitle))]),a("score"),e.isMultiplayer?a("div",{staticClass:"multiplayer-info"},[a("p",{staticClass:"role-message"},[e._v(e._s(e.roleMessage))]),e.bothPlayersReady?a("p",{staticClass:"ready-text"},[e._v("Both players ready! Switching roles...")]):a("p",{staticClass:"waiting-text"},[e._v("Waiting for other player...")])]):e._e(),a("div",{staticClass:"controls"},[e.isMultiplayer?e._e():a("button",{staticClass:"control options",attrs:{type:"button"},on:{mousedown:function(t){e.$store.dispatch("startLevel",e.$store.getters.currentLevel)},touchstart:function(t){t.preventDefault(),t.stopPropagation(),e.$store.dispatch("startLevel",e.$store.getters.currentLevel)}}},[e._v("Replay")]),e.isMultiplayer?e._e():a("button",{staticClass:"control options",attrs:{type:"button"},on:{mousedown:function(t){e.$store.dispatch("nextLevel")},touchstart:function(t){t.preventDefault(),t.stopPropagation(),e.$store.dispatch("nextLevel")}}},[e._v("Next Level")]),e.isMultiplayer&&!e.isReady?a("button",{staticClass:"control options",attrs:{type:"button"},on:{mousedown:e.markReady,touchstart:function(t){return t.preventDefault(),t.stopPropagation(),e.markReady(t)}}},[e._v("Ready for Next Round")]):e._e()])],1)},A=[],S={components:{Score:v},data:function(){return{isReady:!1}},computed:Object(i["a"])({},Object(c["b"])(["isMultiplayer","playerRole","isPlayer","isGuide","roomData"]),{winTitle:function(){return this.isMultiplayer?this.isPlayer?"Level Complete!":"Player Won!":"You Win!"},roleMessage:function(){return this.isPlayer?"Next round, you will be the Guide":"Next round, you will be the Player"},bothPlayersReady:function(){return!(!this.roomData||!this.roomData.gameState)&&(this.roomData.gameState.player1Ready&&this.roomData.gameState.player2Ready)}}),methods:{markReady:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.isReady=!0,e.next=3,this.$store.dispatch("switchRolesAndContinue");case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},watch:{bothPlayersReady:function(e){var t=this;e&&setTimeout(function(){t.isReady=!1},1e3)}}},D=S,O=(a("0fff"),Object(p["a"])(D,P,A,!1,null,"f31832a2",null));O.options.__file="LevelWin.vue";var T=O.exports,H=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"game-three",class:{"play-mode":"play"===e.mode||"characterSelect"===e.mode}},[a("div",{staticClass:"has-to-be-here-for-reactivity"},[a("pre",[e._v("Mode: "+e._s(e.mode)+"\nCharacter: "+e._s(e.character)+"\nScore: "+e._s(e.score)+"\nMoves: "+e._s(e.moves)+"\nFacing: "+e._s(e.facing)+"\n"+e._s(e.map)+"\n      ")])])])},E=[],L=a("8afe"),j=(a("4917"),a("7f7f"),a("ac6a"),a("682a")),G=a.n(j),N=a("5a89");window.THREE=N,a("ff19"),a("af90");var W=new N["GLTFLoader"],$=function(e){var t=0;e.animationNameMap={},e.animations.forEach(function(t){e.animationNameMap[t.name]=t}),e.update=function(a){var n=(a-t)/1e3;e.mixer.update(n),t=a},e.playAnimationByName=function(t){if(e.lastAnimation!==t){e.mixer=new N["AnimationMixer"](e.scene);var a=e.animationNameMap[t],n=e.mixer.clipAction(a);n.play(),e.lastAnimation=t}}},z={},F={},U=function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=[],t.forEach(function(e){if(!z[e]){var t,n,r=new Promise(function(e,a){t=e,n=a});W.load("models/".concat(e,".gltf"),function(a){z[e]=a,$(a),a.scene.children.forEach(function(e){F[e.name]=e}),t(a)},void 0,n),a.push(r)}}),e.next=4,Promise.all(a);case 4:return e.abrupt("return",z);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),B=new N["WebGLRenderer"]({alpha:!0,antialias:!0}),Q=new N["PerspectiveCamera"](45,window.innerWidth/window.innerHeight,.1,1e4),q=new N["Scene"],J=new N["Group"];q.add(J);var Y=new N["DirectionalLight"](16777215,.5);Y.position.set(-2,2,2),Y.castShadow=!0,q.add(Y);var X=new N["DirectionalLight"](16777215,1);X.position.set(1,2,1),X.castShadow=!0,q.add(X);var K=new N["AmbientLight"](16777215,2);q.add(K);var V=new N["HemisphereLight"](13565695,11791088,.5);q.add(V);var Z=new N["Fog"]("#5d3758",9,12);q.fog=Z;var ee=Math.PI/4,te={X:4*-ee,Z:6*-ee,A:6*-ee,Q:0,W:0,E:2*-ee,D:2*-ee,C:4*-ee,S:0," ":0,"┃":0,"━":2*-ee,"┓":4*-ee,"┛":6*-ee,"┗":0,"┏":2*-ee,",":2*-ee,"┻":0,"┣":2*-ee,"┳":4*-ee,"┫":6*-ee,"╋":0,"╻":4*-ee,"╹":0,"╺":2*-ee,"╸":6*-ee,P:0,up:2*-ee,down:6*-ee,left:0,right:4*-ee},ae={G:"ghost",Q:"house_corner",W:"house",E:"house_corner",D:"house",C:"house_corner",X:"house",Z:"house_corner",A:"house",S:"road_spawn"," ":"park","┃":"road_horizontal","━":"road_horizontal","┓":"road_corner","┛":"road_corner","┗":"road_corner","┏":"road_corner",",":"start","┻":"road_tee","┣":"road_tee","┳":"road_tee","┫":"road_tee","╋":"road_plus","╻":"road_end","╹":"road_end","╺":"road_end","╸":"road_end",P:"park",H:"house"},ne=["house_a","house_b","house_c"],re=function(){var e=Math.floor(ne.length*Math.random());return ne[e]},oe=new N["Object3D"];oe.rotation.x=2*-ee;var ie=null,se={},ce=new N["Object3D"],le=[],ue=null,de=null,he=function(){le.shift();var e=le[0];e&&e.start()},pe=function(){de&&ce.remove(de);var e=new N["ConeGeometry"](.3,.8,8),t=new N["MeshBasicMaterial"]({color:65280,transparent:!0,opacity:.8,depthTest:!1,depthWrite:!1});de=new N["Mesh"](e,t),de.scale.setScalar(.7),de.renderOrder=1e3,de.rotation.x=-Math.PI/2,de.rotation.y=0,de.rotation.z=-Math.PI/2,de.position.set(1,0,0),ce.add(de)},me=function(e){de||pe(),de.position.set(1,0,0),de.rotation.x=-Math.PI/2,de.rotation.y=0,de.rotation.z=-Math.PI/2},fe=function(e){ue&&ue.stop();var t=ce.rotation.z,a=2*Math.PI,n=(t%a+a)%a,r=(e%a+a)%a,o=r-n;o>Math.PI?o-=a:o<-Math.PI&&(o+=a);var i=t+o;ue=new G.a.Tween(ce.rotation).to({z:i},200).easing(G.a.Easing.Quadratic.Out).start()},ve=new N["Object3D"],ye=new N["Object3D"];ve.scale.setScalar(2.5),ye.scale.setScalar(2.5),ve.position.set(1,-.65,0),ye.position.set(-1,-.55,0),ve.rotation.set(Math.PI/2,Math.PI,-Math.PI/2),ye.rotation.set(Math.PI/2,Math.PI,-Math.PI/2);var ge,be,xe=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(_e&&Q&&q&&oe){if("characterSelect"===e)return q.remove(oe),q.add(ve),q.add(ye),F.ghost_root&&F.alien_root&&(F.ghost_root.position.set(0,0,0),F.alien_root.position.set(0,0,0),ve.add(F.ghost_root),ye.add(F.alien_root)),Q.position.set(0,0,-5),Q.lookAt(new N["Vector3"](0,0,0)),void(_e&&_e.update&&_e.update());if("lobby"===e||"levelSelect"===e||"levelWin"===e)return q.remove(oe),q.remove(ve),q.remove(ye),void(de&&(de.visible=!1));if("play"===e){if(q.add(oe),q.remove(ve),q.remove(ye),t&&Ce(t),de&&(de.visible=a),a){oe.rotation.x=0,Q.position.set(0,18,0),Q.lookAt(new N["Vector3"](0,0,0)),_e.minPolarAngle=Math.PI/2,_e.maxPolarAngle=Math.PI/2,_e.minAzimuthAngle=-1/0,_e.maxAzimuthAngle=1/0,_e.minDistance=10,_e.maxDistance=30,_e.enableRotate=!1,_e.enableZoom=!0,_e.enablePan=!0;var n=N&&N["MOUSE"]?N["MOUSE"]:{LEFT:0,MIDDLE:1,RIGHT:2};_e.mouseButtons&&"ORBIT"in _e.mouseButtons&&"PAN"in _e.mouseButtons&&(_e.mouseButtons.ORBIT=n.RIGHT,_e.mouseButtons.PAN=n.LEFT,"ZOOM"in _e.mouseButtons&&(_e.mouseButtons.ZOOM=n.MIDDLE)),q.fog=null}else oe.rotation.x=2*-ee,Q.position.set(-1,6,-5),Q.lookAt(new N["Vector3"](0,0,0)),_e.minPolarAngle=-1/0,_e.maxPolarAngle=Math.PI/2,_e.minAzimuthAngle=-1/0,_e.maxAzimuthAngle=1/0,_e.minDistance=1,_e.maxDistance=10,_e.enableRotate=!0,_e.enableZoom=!0,_e.enablePan=!1,q.fog=new N["Fog"]("#5d3758",9,12);_e&&_e.update&&_e.update()}}},Ce=function(e){ce.children[0]&&ce.remove(ce.children[0]);var t=F["".concat(e,"_root")];t&&(t.position.set(0,0,0),ce.add(t),pe())},we=function(e){var t=e.map,a=e.mapRaw,n=e.currentLevel,r=e.facing,o=e.candyHouseIndex,i=e.isGuide;if(ie!==n){var s=se[ie];s&&oe.remove(s),ie=n}var c=se[n],l=t.indexOf("\n",1)-1,u=(t.match(/\n/g)||[]).length-1,d=-l/2+.5,h=-u/2;if(!c){var p=Object(L["a"])(a);c=se[n]=new N["Object3D"];var m=0;p.forEach(function(e,t){if("\n"!==e){var a=Math.floor(m/l),n=m%l,r=c.children[t];if(!r){var s=e.toLocaleUpperCase(),u=ae[s]||"road_spawn";"house"===u&&(u=re());var p=te[s]||0;if(r=F[u].clone(),r.name=u,r.position.x=-(n+d),r.position.y=a+h,r.rotation.z=p,0===u.indexOf("house")&&t===o){var f=F.candy_circle.clone();f.visible=i,f.name="candy_circle",r.add(f)}c.add(r)}m++}else{var v=new N["Object3D"];c.add(v)}})}c.add(ce);var f=Object(L["a"])(t);f.length&&f[0];var v=t.indexOf("G");if(v>=0){var y=v-1,g=Math.floor(y/(l+1)),b=y-g*(l+1),x=te[r]||0,C=new G.a.Tween(ce.position).to({x:-(b+d),y:g+h},100).easing(G.a.Easing.Quadratic.Out).onUpdate(function(){i||(c.position.x=-ce.position.x,c.position.y=-ce.position.y)}).onComplete(he);le.push(C),le.length<2&&C.start(),fe(x),me(r)}for(var w=0;w<t.length;w++){var _=t.charAt(w);if("\n"!==_){var M=c.children[w];if(M&&M.name&&0===M.name.indexOf("house")){var R=w===o,k=M.children.length>0&&"candy_circle"===M.children[0].name;if(R&&!k){console.log("🍭 Adding candy to house at index",w,"isGuide:",i);var I=F.candy_circle.clone();I.visible=i,I.name="candy_circle",M.add(I)}else if(!R&&k)console.log("🗑️ Removing candy from house at index",w),M.remove(M.children[0]);else if(k){var P=_===_.toLocaleUpperCase();M.children[0].visible=P&&i}}}}oe.add(c)};B.shadowMap.enabled=!0,B.shadowMap.type=N["PCFSoftShadowMap"];var _e,Me=new N["Vector2"],Re=Math.PI/180,ke=function(){var e=B.domElement.clientWidth,t=B.domElement.clientHeight,a=window.devicePixelRatio;if(ge=e*a,be=t*a,B.domElement.width!==ge||B.domElement.height!==be){var n=ge/be,r=ee;Q.fov=(n>=1?r:2*Math.atan(Math.tan(r/2)/n))/Re,Q.aspect=n,Q.updateProjectionMatrix(),B.setPixelRatio(a),B.setSize(e,t,!1),Me.set(ge/2,be/2)}},Ie=!0,Pe=function e(t){Ie&&(requestAnimationFrame(e),ke(),Se(t))},Ae=function(e){e.appendChild(B.domElement),_e=new N["OrbitControls"](Q,B.domElement),Q.position.set(-1,6,-5),Q.lookAt(new N["Vector3"](0,0,0)),_e.enableDamping=!0,_e.dampingFactor=.25,_e.screenSpacePanning=!1,_e.enablePan=!1,_e.minDistance=1,_e.maxDistance=10,_e.minPolarAngle=-1/0,_e.maxPolarAngle=Math.PI/2,requestAnimationFrame(Pe)},Se=function(e){_e.update(),G.a.update(e),B.render(q,Q)},De={data:function(){return{loaded:!1,lastMap:null}},computed:Object(i["a"])({},Object(c["b"])(["mode","character","currentLevel","lastDirection","facing","levels","score","moves","map","candyHouseIndex","isGuide","isPlayer","isMultiplayer","activePlayerCharacter"]),{displayCharacter:function(){return this.isMultiplayer&&this.activePlayerCharacter||this.character}}),mounted:function(){Ae(this.$el),this.startLoad()},destroyed:function(){Ie=!1},beforeUpdate:function(){this.updateState()},methods:{startLoad:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,U(["city","characters"]);case 2:console.log("Loaded",F),this.loaded=!0,this.updateState(),xe(this.mode,this.displayCharacter,this.isGuide);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),updateState:function(){this.map&&this.loaded&&this.lastMap!==this.map&&null!==this.currentLevel&&(we({map:this.map,mapRaw:this.levels[this.currentLevel],currentLevel:this.currentLevel,facing:this.facing,candyHouseIndex:this.candyHouseIndex,isGuide:this.isGuide}),this.lastMap=this.map)}},watch:{mode:function(){var e=this;xe(this.mode,this.displayCharacter,this.isGuide),"play"===this.mode&&this.loaded&&this.$nextTick(function(){e.updateState()})},currentLevel:function(){this.updateState()},facing:function(){if(this.loaded&&"play"===this.mode){var e=te[this.facing]||0;fe(e),this.isGuide&&me(this.facing)}},isGuide:function(){this.loaded&&"play"===this.mode&&(xe(this.mode,this.displayCharacter,this.isGuide),this.isGuide&&(oe&&oe.children[this.currentLevel]&&(oe.children[this.currentLevel].position.x=0,oe.children[this.currentLevel].position.y=0),de||pe(),me(this.facing)))},displayCharacter:function(){this.loaded&&"play"===this.mode&&Ce(this.displayCharacter)}}},Oe=De,Te=(a("8089"),Object(p["a"])(Oe,H,E,!1,null,null,null));Te.options.__file="GameThree.vue";var He=Te.exports,Ee=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"character-select"},[a("h1",[e._v("Halloween Game!")]),a("p",[e._v("Pick a character")]),a("div",{staticClass:"characters"},[a("div",{staticClass:"characters-square"},e._l(e.$options.characters,function(t){return a("div",{key:t,staticClass:"character",class:t,on:{touchstart:function(a){a.preventDefault(),a.stopPropagation(),e.$store.dispatch("selectCharacter",t)},mousedown:function(a){e.$store.dispatch("selectCharacter",t)}}})}))])])},Le=[],je={characters:["ghost","alien"],components:{Score:v}},Ge=je,Ne=(a("c434"),Object(p["a"])(Ge,Ee,Le,!1,null,"cf5bdaa4",null));Ne.options.__file="CharacterSelect.vue";var We=Ne.exports,$e=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"map-editor"},[a("div",{staticClass:"editor-header"},[a("h2",[e._v("Map Editor")]),a("div",{staticClass:"editor-controls"},[a("button",{staticClass:"control",on:{click:e.clearMap}},[e._v("Clear")]),a("button",{staticClass:"control",on:{click:function(t){e.showLoadDialog=!0}}},[e._v("Load")]),a("button",{staticClass:"control",on:{click:e.testMap}},[e._v("Test")]),a("button",{staticClass:"control",on:{click:e.saveMap}},[e._v("Save")]),a("button",{staticClass:"control",on:{click:function(t){e.$store.dispatch("mode","levelSelect")}}},[e._v("Back")])]),a("div",{staticClass:"editor-info"},[a("span",[e._v(e._s(e.mapWidth)+"x"+e._s(e.mapHeight))]),a("button",{staticClass:"control small",on:{click:function(t){e.resizeMap(-1,0)}}},[e._v("-W")]),a("button",{staticClass:"control small",on:{click:function(t){e.resizeMap(1,0)}}},[e._v("+W")]),a("button",{staticClass:"control small",on:{click:function(t){e.resizeMap(0,-1)}}},[e._v("-H")]),a("button",{staticClass:"control small",on:{click:function(t){e.resizeMap(0,1)}}},[e._v("+H")]),a("span",{staticClass:"divider"},[e._v("|")]),a("span",[e._v(e._s(e.getSelectedTileName()))]),a("span",{staticClass:"controls-hint"},[e._v("| Drag/Right-drag/Scroll = Rotate/Pan/Zoom")]),a("label",{staticClass:"direction-toggle"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.showDirectionIndicators,expression:"showDirectionIndicators"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showDirectionIndicators)?e._i(e.showDirectionIndicators,null)>-1:e.showDirectionIndicators},on:{change:[function(t){var a=e.showDirectionIndicators,n=t.target,r=!!n.checked;if(Array.isArray(a)){var o=null,i=e._i(a,o);n.checked?i<0&&(e.showDirectionIndicators=a.concat([o])):i>-1&&(e.showDirectionIndicators=a.slice(0,i).concat(a.slice(i+1)))}else e.showDirectionIndicators=r},e.render3DMap]}}),e._v("\n        Show Directions\n      ")]),a("span",{staticClass:"divider"},[e._v("|")]),a("label",{staticClass:"mode-toggle"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.editMode,expression:"editMode"}],attrs:{type:"radio",value:"tiles"},domProps:{checked:e._q(e.editMode,"tiles")},on:{change:function(t){e.editMode="tiles"}}}),a("span",[e._v("Tiles")])]),a("label",{staticClass:"mode-toggle"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.editMode,expression:"editMode"}],attrs:{type:"radio",value:"nodes"},domProps:{checked:e._q(e.editMode,"nodes")},on:{change:function(t){e.editMode="nodes"}}}),e._m(0)]),a("label",{staticClass:"mode-toggle"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.editMode,expression:"editMode"}],attrs:{type:"radio",value:"paths"},domProps:{checked:e._q(e.editMode,"paths")},on:{change:function(t){e.editMode="paths"}}}),e._m(1)]),a("label",{staticClass:"mode-toggle"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.editMode,expression:"editMode"}],attrs:{type:"radio",value:"delete"},domProps:{checked:e._q(e.editMode,"delete")},on:{change:function(t){e.editMode="delete"}}}),a("span",[e._v("Delete")])]),"paths"===e.editMode?a("button",{staticClass:"control small",on:{click:e.autoGeneratePaths}},[e._v("Auto-Generate Paths")]):e._e()])]),e.showLoadDialog?a("div",{staticClass:"modal-overlay",on:{click:function(t){e.showLoadDialog=!1}}},[a("div",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation()}}},[a("h3",[e._v("Load Map")]),a("p",[e._v("Paste your map data below (without the road tiles line):")]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.loadMapInput,expression:"loadMapInput"}],staticClass:"map-input",attrs:{placeholder:"Paste map here...",rows:"15"},domProps:{value:e.loadMapInput},on:{input:function(t){t.target.composing||(e.loadMapInput=t.target.value)}}}),a("div",{staticClass:"modal-buttons"},[a("button",{staticClass:"control",on:{click:e.loadMap}},[e._v("Load")]),a("button",{staticClass:"control",on:{click:function(t){e.showLoadDialog=!1,e.loadMapInput=""}}},[e._v("Cancel")])]),e.loadError?a("p",{staticClass:"error"},[e._v(e._s(e.loadError))]):e._e()])]):e._e(),a("div",{staticClass:"editor-body"},[a("div",{staticClass:"tile-palette",class:{collapsed:"tiles"!==e.editMode}},["tiles"===e.editMode?[a("h3",[e._v("Tiles")]),a("div",{staticClass:"palette-section"},[a("h4",[e._v("Special")]),e._l(e.specialTiles,function(t){return a("button",{key:t.char,staticClass:"palette-tile",class:{selected:e.selectedTile===t.char},attrs:{title:t.name},on:{click:function(a){e.selectedTile=t.char}}},[a("span",{staticClass:"tile-char"},[e._v(e._s(t.char))]),a("span",{staticClass:"tile-label"},[e._v(e._s(t.name))])])})],2),a("div",{staticClass:"palette-section"},[a("h4",[e._v("Roads")]),e._l(e.roadTiles,function(t){return a("button",{key:t.char,staticClass:"palette-tile",class:{selected:e.selectedTile===t.char},attrs:{title:t.name},on:{click:function(a){e.selectedTile=t.char}}},[a("span",{staticClass:"tile-char"},[e._v(e._s(t.char))]),a("span",{staticClass:"tile-label"},[e._v(e._s(t.name))])])})],2),a("div",{staticClass:"palette-section"},[a("h4",[e._v("Houses")]),e._l(e.houseTiles,function(t){return a("button",{key:t.char,staticClass:"palette-tile",class:{selected:e.selectedTile===t.char},attrs:{title:t.name},on:{click:function(a){e.selectedTile=t.char}}},[a("span",{staticClass:"tile-char"},[e._v(e._s(t.char))]),a("span",{staticClass:"tile-label"},[e._v(e._s(t.name))])])})],2),a("div",{staticClass:"palette-section"},[a("h4",[e._v("Scenery")]),e._l(e.sceneryTiles,function(t){return a("button",{key:t.char,staticClass:"palette-tile",class:{selected:e.selectedTile===t.char},attrs:{title:t.name},on:{click:function(a){e.selectedTile=t.char}}},[a("span",{staticClass:"tile-char"},[e._v(e._s(t.char))]),a("span",{staticClass:"tile-label"},[e._v(e._s(t.name))])])})],2)]:"nodes"===e.editMode?[a("h3",[e._v("Place Nodes")]),a("div",{staticClass:"palette-section"},[a("h4",[e._v("Node Type")]),a("button",{staticClass:"palette-tile wide",class:{selected:"junction"===e.pointType},on:{click:function(t){e.pointType="junction"}}},[e._m(2)]),a("button",{staticClass:"palette-tile wide",class:{selected:"houseStop"===e.pointType},on:{click:function(t){e.pointType="houseStop"}}},[e._m(3)]),a("button",{staticClass:"palette-tile wide",class:{selected:"both"===e.pointType},on:{click:function(t){e.pointType="both"}}},[e._m(4)])]),a("p",{staticClass:"help-text"},[e._v("Click on a tile to place a node. Auto-generate will create these automatically.")])]:"paths"===e.editMode?[a("h3",[e._v("Draw Paths")]),a("div",{staticClass:"palette-section"},[a("p",{staticClass:"help-text"},[e._v("Click and drag between tiles to draw paths. Paths connect nodes automatically.")]),a("button",{staticClass:"control",on:{click:e.finishPath}},[e._v("Finish Path")]),a("button",{staticClass:"control",on:{click:e.clearDraft}},[e._v("Clear Draft")])])]:"delete"===e.editMode?[a("h3",[e._v("Delete")]),e._m(5)]:[a("h3",[e._v("Navigation")]),e._m(6),"nodes"===e.editMode?a("div",{staticClass:"palette-section"},[a("h4",[e._v("Point Type")]),a("button",{staticClass:"palette-tile",class:{selected:"junction"===e.pointType},on:{click:function(t){e.pointType="junction"}}},[a("span",{staticClass:"tile-label"},[e._v("Junction/Turn")])]),a("button",{staticClass:"palette-tile",class:{selected:"houseStop"===e.pointType},on:{click:function(t){e.pointType="houseStop"}}},[a("span",{staticClass:"tile-label"},[e._v("House Stop")])])]):e._e(),"paths"===e.editMode?a("div",{staticClass:"palette-section"},[a("p",{staticClass:"hint"},[e._v("Click to add segments. Existing points autoconnect.")])]):e._e()]],2),a("div",{ref:"map3dContainer",staticClass:"map-3d-container"})])])},ze=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",[e._v("Place"),a("br"),e._v("Nodes")])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",[e._v("Draw"),a("br"),e._v("Paths")])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"tile-label"},[e._v("Junction"),a("br"),e._v("(Turn Point)")])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"tile-label"},[e._v("House Stop"),a("br"),e._v("(Short Forward)")])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"tile-label"},[e._v("Junction + House"),a("br"),e._v("(Both Buttons)")])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"palette-section"},[a("p",{staticClass:"help-text"},[e._v("Click on a node or path to delete it")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"palette-section"},[a("p",{staticClass:"help-text"},[e._v("Select a mode from the top toolbar")])])}],Fe=(a("28a5"),a("4f7f"),a("6762"),a("9393"));a("ffc1"),a("2fdb"),a("20d6"),a("ac4d"),a("8a81"),a("7514"),a("6c7b");window.THREE=N,a("ff19"),a("af90");var Ue=Math.PI/4,Be={X:4*-Ue,Z:6*-Ue,A:6*-Ue,Q:0,W:0,E:2*-Ue,D:2*-Ue,C:4*-Ue,S:0," ":0,"┃":0,"━":2*-Ue,"┓":4*-Ue,"┛":6*-Ue,"┗":0,"┏":2*-Ue,",":2*-Ue,"┻":0,"┣":2*-Ue,"┳":4*-Ue,"┫":6*-Ue,"╋":0,"╻":4*-Ue,"╹":0,"╺":2*-Ue,"╸":6*-Ue,P:0,"!":0,H:0},Qe={Q:"house_corner",W:"house",E:"house_corner",D:"house",C:"house_corner",X:"house",Z:"house_corner",A:"house",S:"road_spawn"," ":"park","┃":"road_horizontal","━":"road_horizontal","┓":"road_corner","┛":"road_corner","┗":"road_corner","┏":"road_corner",",":"start","┻":"road_tee","┣":"road_tee","┳":"road_tee","┫":"road_tee","╋":"road_plus","╻":"road_end","╹":"road_end","╺":"road_end","╸":"road_end",P:"park","!":"road_spawn",H:"house"},qe={name:"MapEditor",data:function(){return{mapWidth:10,mapHeight:10,mapData:[],selectedTile:"S",isDragging:!1,mouseDownPos:null,mouseMoved:!1,isDraggingPath:!1,dragStartNode:null,gltfLoader:null,unpackedObjectMap:{},renderer:null,camera:null,scene:null,mapGroup:null,tileObjects:[],raycaster:null,mouse:null,loaded:!1,animationId:null,controls:null,editMode:"tiles",nodes:[],edges:[],overlayGroup:null,pointType:"junction",pathDraftNode:null,showLoadDialog:!1,loadMapInput:"",loadError:"",showDirectionIndicators:!1,specialTiles:[{char:"S",name:"Spawn"},{char:"!",name:"Exit"}],roadTiles:[{char:"┃",name:"Road |"},{char:"━",name:"Road -"},{char:"┓",name:"Corner"},{char:"┛",name:"Corner"},{char:"┗",name:"Corner"},{char:"┏",name:"Corner"},{char:"┻",name:"T-Road"},{char:"┣",name:"T-Road"},{char:"┳",name:"T-Road"},{char:"┫",name:"T-Road"},{char:"╋",name:"Cross"},{char:"╻",name:"End"},{char:"╹",name:"End"},{char:"╺",name:"End"},{char:"╸",name:"End"}],houseTiles:[{char:"Q",name:"House"},{char:"W",name:"House"},{char:"E",name:"House"},{char:"D",name:"House"},{char:"C",name:"House"},{char:"X",name:"House"},{char:"Z",name:"House"},{char:"A",name:"House"}],sceneryTiles:[{char:"P",name:"Park"},{char:"H",name:"House"}]}},mounted:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.initializeMap(),e.next=3,this.loadAssets();case 3:this.init3D(),this.render3DMap();case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),beforeDestroy:function(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.controls&&(this.controls.dispose(),this.controls=null),this.renderer&&this.renderer.domElement&&(this.renderer.domElement.removeEventListener("mousedown",this.onMapMouseDown),this.renderer.domElement.removeEventListener("mouseup",this.onMapMouseUp),this.renderer.domElement.removeEventListener("mousemove",this.onMapMouseMove)),this.renderer&&(this.renderer.dispose(),this.renderer=null),this.scene=null,this.camera=null,this.mapGroup=null,this.tileObjects=[]},methods:{loadAssets:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.gltfLoader=new N["GLTFLoader"],e.next=3,new Promise(function(e,t){a.gltfLoader.load("models/city.gltf",e,void 0,t)});case 3:t=e.sent,t.scene.children.forEach(function(e){a.unpackedObjectMap[e.name]=e}),this.loaded=!0;case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),init3D:function(){var e=this;if(this.$refs.map3dContainer){this.renderer=new N["WebGLRenderer"]({alpha:!0,antialias:!0}),this.renderer.setSize(this.$refs.map3dContainer.clientWidth,this.$refs.map3dContainer.clientHeight),this.$refs.map3dContainer.appendChild(this.renderer.domElement),this.camera=new N["PerspectiveCamera"](45,this.$refs.map3dContainer.clientWidth/this.$refs.map3dContainer.clientHeight,.1,1e3),this.updateCameraPosition(),this.camera.lookAt(0,0,0),this.scene=new N["Scene"],this.scene.fog=new N["Fog"]("#5d3758",15,25);var t=new N["DirectionalLight"](16777215,.5);t.position.set(-2,2,2),this.scene.add(t);var a=new N["DirectionalLight"](16777215,1);a.position.set(1,2,1),this.scene.add(a);var n=new N["AmbientLight"](16777215,2);this.scene.add(n);var r=new N["HemisphereLight"](13565695,11791088,.5);this.scene.add(r),this.mapGroup=new N["Group"],this.mapGroup.rotation.x=2*-Ue,this.scene.add(this.mapGroup),this.overlayGroup=new N["Group"],this.mapGroup.add(this.overlayGroup),this.raycaster=new N["Raycaster"],this.mouse=new N["Vector2"],this.controls=new N["OrbitControls"](this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.25,this.controls.screenSpacePanning=!1,this.controls.minDistance=5,this.controls.maxDistance=30,this.controls.maxPolarAngle=Math.PI/2,this.renderer.domElement.addEventListener("mousedown",this.onMapMouseDown),this.renderer.domElement.addEventListener("mouseup",this.onMapMouseUp),this.renderer.domElement.addEventListener("mousemove",this.onMapMouseMove);var o=function t(){e.renderer&&e.scene&&e.camera&&e.controls&&(e.animationId=requestAnimationFrame(t),e.controls.update(),e.renderer.render(e.scene,e.camera))};o()}},updateCameraPosition:function(){if(this.camera){var e=Math.max(this.mapWidth,this.mapHeight),t=1.2*e+5;this.camera.position.set(0,t,.7*t),this.camera.lookAt(0,0,0),this.controls&&this.controls.update()}},initializeMap:function(){this.mapData=new Array(this.mapWidth*this.mapHeight).fill("P");var e=Math.floor(this.mapHeight/2*this.mapWidth+this.mapWidth/2);this.mapData[e]="S",this.loaded&&(this.updateCameraPosition(),this.render3DMap())},resizeMap:function(e,t){var a=Math.max(5,Math.min(30,this.mapWidth+e)),n=Math.max(5,Math.min(30,this.mapHeight+t));if(a!==this.mapWidth||n!==this.mapHeight){for(var r=new Array(a*n).fill("P"),o=0;o<Math.min(this.mapHeight,n);o++)for(var i=0;i<Math.min(this.mapWidth,a);i++){var s=o*this.mapWidth+i,c=o*a+i;r[c]=this.mapData[s]||"P"}this.mapWidth=a,this.mapHeight=n,this.mapData=r,this.updateCameraPosition(),this.render3DMap()}},render3DMap:function(){var e=this;if(this.mapGroup&&this.loaded){var t=Object(L["a"])(this.mapGroup.children);t.forEach(function(t){t!==e.overlayGroup&&e.mapGroup.remove(t)}),this.tileObjects=[];for(var a=-this.mapWidth/2+.5,n=-this.mapHeight/2,r=["house_a","house_b","house_c"],o=function(e,t){var a=(7*e+13*t)%r.length;return r[a]},i=0;i<this.mapHeight;i++)for(var s=0;s<this.mapWidth;s++){var c=i*this.mapWidth+s,l=this.mapData[c],u=Qe[l]||"park",d=Be[l]||0;if("house"===u&&(u=o(s,i)),this.unpackedObjectMap[u]){var h=this.unpackedObjectMap[u].clone();h.position.x=-(s+a),h.position.y=i+n,h.rotation.z=d,h.userData={index:c,x:s,y:i},this.mapGroup.add(h),this.tileObjects.push(h)}}this.showDirectionIndicators&&this.addCompassLabels(a,n),this.renderOverlay()}},addCompassLabels:function(e,t){var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#ff0000",a=document.createElement("canvas"),n=a.getContext("2d");a.width=256,a.height=256,n.fillStyle=t,n.font="Bold 180px Arial",n.textAlign="center",n.textBaseline="middle",n.fillText(e,128,128);var r=new N["CanvasTexture"](a),o=new N["SpriteMaterial"]({map:r}),i=new N["Sprite"](o);return i.scale.set(2,2,1),i},n=a("N");n.position.set(0,-this.mapHeight/2-1.5,1),this.mapGroup.add(n);var r=a("S");r.position.set(0,this.mapHeight/2+1.5,1),this.mapGroup.add(r);var o=a("E");o.position.set(-this.mapWidth/2-1.5,0,1),this.mapGroup.add(o);var i=a("W");i.position.set(this.mapWidth/2+1.5,0,1),this.mapGroup.add(i)},onMapMouseDown:function(e){if(this.mouseDownPos={x:e.clientX,y:e.clientY},this.mouseMoved=!1,"paths"===this.editMode){var t=this.screenToTile(e);if(t){var a=this.nodes.find(function(e){return e.x===t.x&&e.y===t.y});a||(a={x:t.x,y:t.y,type:"junction"},this.nodes.push(a)),this.dragStartNode=a,this.isDraggingPath=!0,this.controls&&(this.controls.enabled=!1)}}},renderOverlay:function(){var e=this;if(this.overlayGroup){while(this.overlayGroup.children.length>0)this.overlayGroup.remove(this.overlayGroup.children[0]);var t=-this.mapWidth/2+.5,a=-this.mapHeight/2,n=new N["SphereGeometry"](.12,10,10);this.nodes.forEach(function(r){var o=r.x,i=r.y,s=r.type,c=65535;"houseStop"===s&&(c=16729156),"both"===s&&(c=16711935);var l=new N["MeshBasicMaterial"]({color:c}),u=new N["Mesh"](n,l);u.position.x=-(o+t),u.position.y=i+a,u.position.z=.05,e.overlayGroup.add(u)});var r=new N["LineBasicMaterial"]({color:16763904});this.edges.forEach(function(n){var o=n.from,i=n.to,s=[];s.push(new N["Vector3"](-(o.x+t),o.y+a,.05)),s.push(new N["Vector3"](-(i.x+t),i.y+a,.05));var c=(new N["BufferGeometry"]).setFromPoints(s),l=new N["Line"](c,r);e.overlayGroup.add(l)})}},onMapMouseMove:function(e){if(this.mouseDownPos){var t=e.clientX-this.mouseDownPos.x,a=e.clientY-this.mouseDownPos.y,n=Math.sqrt(t*t+a*a);n>5&&(this.mouseMoved=!0)}this.renderOverlay()},onMapMouseUp:function(e){var t=this;if(this.isDraggingPath&&this.dragStartNode){var a=this.screenToTile(e);if(a){var n=this.nodes.find(function(e){return e.x===a.x&&e.y===a.y});if(n||(n={x:a.x,y:a.y,type:"junction"},this.nodes.push(n)),this.dragStartNode.x!==n.x||this.dragStartNode.y!==n.y){var r=this.edges.some(function(e){return e.from.x===t.dragStartNode.x&&e.from.y===t.dragStartNode.y&&e.to.x===n.x&&e.to.y===n.y||e.to.x===t.dragStartNode.x&&e.to.y===t.dragStartNode.y&&e.from.x===n.x&&e.from.y===n.y});r||this.edges.push({from:{x:this.dragStartNode.x,y:this.dragStartNode.y},to:{x:n.x,y:n.y}})}}this.isDraggingPath=!1,this.dragStartNode=null,this.controls&&(this.controls.enabled=!0),this.renderOverlay()}else!this.mouseMoved&&this.mouseDownPos&&("tiles"===this.editMode?this.placeTileAtClick(e):"nodes"===this.editMode?this.placeNodeAtClick(e):"delete"===this.editMode&&this.deleteAtClick(e));this.mouseDownPos=null,this.mouseMoved=!1},screenToTile:function(e){var t=this.renderer.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-t.left)/t.width*2-1,this.mouse.y=-(e.clientY-t.top)/t.height*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);var a=this.raycaster.intersectObjects(this.tileObjects,!0);if(a.length>0){var n=!0,r=!1,o=void 0;try{for(var i,s=a[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value,l=c.object;while(l&&!l.userData.index&&l.parent)if(l=l.parent,l===this.scene||l===this.mapGroup)break;if(l&&l.userData&&void 0!==l.userData.index)return{index:l.userData.index,x:l.userData.x,y:l.userData.y}}}catch(e){r=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw o}}}return null},placeTileAtClick:function(e){if(this.renderer&&this.camera&&this.raycaster&&this.mouse){var t=this.screenToTile(e);t&&void 0!==t.index&&(this.$set(this.mapData,t.index,this.selectedTile),this.render3DMap())}},placeNodeAtClick:function(e){var t=this.screenToTile(e);t&&(this.nodes.push({x:t.x,y:t.y,type:this.pointType}),this.render3DMap())},deleteAtClick:function(e){var t=this.screenToTile(e);if(t){var a=this.nodes.findIndex(function(e){return e.x===t.x&&e.y===t.y});if(-1!==a){var n=this.nodes[a];return this.edges=this.edges.filter(function(e){return!(e.from.x===n.x&&e.from.y===n.y)&&!(e.to.x===n.x&&e.to.y===n.y)}),this.nodes.splice(a,1),void this.renderOverlay()}for(var r=0;r<this.edges.length;r++){var o=this.edges[r],i=o.to.x-o.from.x,s=o.to.y-o.from.y,c=Math.sqrt(i*i+s*s);if(0!==c){var l=Math.max(0,Math.min(1,((t.x-o.from.x)*i+(t.y-o.from.y)*s)/(c*c))),u=o.from.x+l*i,d=o.from.y+l*s,h=Math.sqrt(Math.pow(t.x-u,2)+Math.pow(t.y-d,2));if(h<.5)return this.edges.splice(r,1),void this.renderOverlay()}}}},finishPath:function(){this.pathDraftNode=null},clearDraft:function(){this.pathDraftNode=null},autoGeneratePaths:function(){var e=this;if(confirm("Auto-generate paths along all roads? This will clear existing paths.")){this.nodes=[],this.edges=[];for(var t="SH┃━┓┛┗┏┻┣┳┫╋╻╹╺╸",a={Q:["up","left"],W:["up"],E:["up","right"],D:["right"],C:["down","right"],X:["down"],Z:["down","left"],A:["left"],H:["up"]},n=function(a,n){if(a<0||a>=e.mapWidth||n<0||n>=e.mapHeight)return!1;var r=n*e.mapWidth+a;return t.includes(e.mapData[r])},r=function(t,a){if(t<0||t>=e.mapWidth||a<0||a>=e.mapHeight)return null;var n=a*e.mapWidth+t;return e.mapData[n]},o=function(e,t,n){for(var o={up:{dx:0,dy:-1,houseDir:"down"},down:{dx:0,dy:1,houseDir:"up"},left:{dx:-1,dy:0,houseDir:"right"},right:{dx:1,dy:0,houseDir:"left"}},i=Object.entries(o),s=0;s<i.length;s++){var c=Object(Fe["a"])(i[s],2),l=c[0],u=c[1],d=e+u.dx,h=t+u.dy,p=r(d,h);if(p&&a[p]){var m=a[p];if(m.includes(u.houseDir))return{hasHouse:!0,direction:l}}}return{hasHouse:!1}},i=function(e,t){var a=0;return n(e-1,t)&&a++,n(e+1,t)&&a++,n(e,t-1)&&a++,n(e,t+1)&&a++,a},s=function(e,t){var a=n(e-1,t),r=n(e+1,t),o=n(e,t-1),i=n(e,t+1),s=(a||r)&&!(a&&r),c=(o||i)&&!(o&&i);return s&&c},c=function(e,t){var a=i(e,t);return 1===a||a>=3||s(e,t)},l={},u=0;u<this.mapHeight;u++)for(var d=0;d<this.mapWidth;d++){var h=u*this.mapWidth+d,p=this.mapData[h];if(t.includes(p)){var m="S"===p,f=c(d,u),v=o(d,u),y=null;if(m?y=v.hasHouse?"both":"junction":f&&v.hasHouse?y="both":f?y="junction":v.hasHouse&&(y="houseStop"),y){var g={x:d,y:u,type:y};this.nodes.push(g),l["".concat(d,",").concat(u)]=g}}}var b=new Set,x=function(e,t,a,r){var o=e+a,i=t+r;while(n(o,i)){var s="".concat(o,",").concat(i);if(l[s])return{x:o,y:i};var c=[];if(!n(o-1,i)||1===a&&0===r||c.push({dx:-1,dy:0}),!n(o+1,i)||-1===a&&0===r||c.push({dx:1,dy:0}),!n(o,i-1)||0===a&&1===r||c.push({dx:0,dy:-1}),!n(o,i+1)||0===a&&-1===r||c.push({dx:0,dy:1}),0===c.length)break;if(c.length>1)break;a=c[0].dx,r=c[0].dy,o+=a,i+=r}return null},C=!0,w=!1,_=void 0;try{for(var M,R=this.nodes[Symbol.iterator]();!(C=(M=R.next()).done);C=!0)for(var k=M.value,I=[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1}],P=0;P<I.length;P++){var A=I[P],S=k.x+A.dx,D=k.y+A.dy;if(n(S,D)){var O=x(k.x,k.y,A.dx,A.dy);if(O){var T="".concat(Math.min(k.x,O.x),",").concat(Math.min(k.y,O.y),"-").concat(Math.max(k.x,O.x),",").concat(Math.max(k.y,O.y));b.has(T)||(b.add(T),this.edges.push({from:{x:k.x,y:k.y},to:{x:O.x,y:O.y}}))}}}}catch(e){w=!0,_=e}finally{try{C||null==R.return||R.return()}finally{if(w)throw _}}this.renderOverlay();var H=this.nodes.filter(function(e){return"junction"===e.type}).length,E=this.nodes.filter(function(e){return"houseStop"===e.type}).length,L=this.nodes.filter(function(e){return"both"===e.type}).length;alert("Generated ".concat(this.nodes.length," nodes (").concat(H," junctions, ").concat(E," house stops, ").concat(L," junction+house) and ").concat(this.edges.length," edges"))}},getSelectedTileName:function(){var e=this,t=Object(L["a"])(this.specialTiles).concat(Object(L["a"])(this.roadTiles),Object(L["a"])(this.houseTiles),Object(L["a"])(this.sceneryTiles)),a=t.find(function(t){return t.char===e.selectedTile});return a?a.name:""},clearMap:function(){confirm("Clear the entire map?")&&this.initializeMap()},loadMap:function(){try{this.loadError="";var e=this.loadMapInput.trim();if(!e)return void(this.loadError="Please paste a map");var t=e.split("\n---META---\n"),a=t[0],n=t[1],r=a.split("\n").filter(function(e){return e.length>0});if(0===r.length)return void(this.loadError="Invalid map format");for(var o=r.length,i=r[0].length,s=0;s<r.length;s++)if(r[s].length!==i)return void(this.loadError="Line ".concat(s+1," has incorrect width (expected ").concat(i,", got ").concat(r[s].length,")"));this.mapWidth=i,this.mapHeight=o,this.mapData=[];for(var c=0;c<o;c++)for(var l=0;l<i;l++)this.mapData.push(r[c][l]);if(this.nodes=[],this.edges=[],n)try{var u=JSON.parse(n);this.nodes=Array.isArray(u.nodes)?u.nodes:[],this.edges=Array.isArray(u.edges)?u.edges:[]}catch(e){this.loadError="Meta section could not be parsed; ignoring."}this.updateCameraPosition(),this.render3DMap(),this.showLoadDialog=!1,this.loadMapInput=""}catch(e){this.loadError="Error loading map: "+e.message}},testMap:function(){if(this.mapData.includes("S")){var e=this.convertMapToString();this.$store.dispatch("testCustomMap",e)}else alert("Map must have at least one spawn point (S)!")},saveMap:function(){if(this.mapData.includes("S")){var e=this.convertMapToString(),t={nodes:this.nodes,edges:this.edges},a=new Blob([e+"\n---META---\n"+JSON.stringify(t,null,2)],{type:"text/plain"}),n=URL.createObjectURL(a),r=document.createElement("a");r.href=n,r.download="custom-map.txt",r.click(),URL.revokeObjectURL(n),alert("Map saved! You can add it to levels.txt")}else alert("Map must have at least one spawn point (S)!")},convertMapToString:function(){for(var e="\n",t=0;t<this.mapHeight;t++){for(var a=0;a<this.mapWidth;a++){var n=t*this.mapWidth+a;e+=this.mapData[n]}e+="\n"}return e}}},Je=qe,Ye=(a("1358"),Object(p["a"])(Je,$e,ze,!1,null,"e2a5972c",null));Ye.options.__file="MapEditor.vue";var Xe=Ye.exports,Ke=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"lobby"},[a("div",{staticClass:"lobby-container"},[a("h1",[e._v("🎃 Trick or Treat 🍬")]),"menu"===e.state?a("div",{staticClass:"menu"},[a("p",[e._v("遊び方を選択してください")]),a("button",{staticClass:"control options",on:{click:e.showCreateRoom}},[e._v("Make Room")]),a("button",{staticClass:"control options",on:{click:e.showJoinRoom}},[e._v("Join Room")])]):e._e(),"create"===e.state?a("div",{staticClass:"create-room"},[a("h2",[e._v("ルームを作成")]),e._m(0),a("button",{staticClass:"control options",on:{click:e.createRoom}},[e._v("Make Room")]),a("button",{staticClass:"control options back-btn",on:{click:e.backToMenu}},[e._v("Back")])]):e._e(),"join"===e.state?a("div",{staticClass:"join-room"},[a("h2",[e._v("Join a Room")]),e._m(1),a("input",{directives:[{name:"model",rawName:"v-model",value:e.roomCodeInput,expression:"roomCodeInput"}],staticClass:"input-field",attrs:{type:"text",placeholder:"Enter 5-digit room code",maxlength:"5"},domProps:{value:e.roomCodeInput},on:{input:[function(t){t.target.composing||(e.roomCodeInput=t.target.value)},e.validateRoomCode]}}),a("button",{staticClass:"control options",attrs:{disabled:5!==e.roomCodeInput.length},on:{click:e.joinRoom}},[e._v("Join Room")]),a("button",{staticClass:"control options back-btn",on:{click:e.backToMenu}},[e._v("Back")]),e.error?a("p",{staticClass:"error"},[e._v(e._s(e.error))]):e._e()]):e._e(),"waiting"===e.state?a("div",{staticClass:"waiting-room"},[a("h2",[e._v("Room Code: "+e._s(e.currentRoomCode))]),a("p",{staticClass:"room-code-display"},[e._v(e._s(e.currentRoomCode))]),e.isHost?a("p",[e._v("もう一人のプレイヤーが参加するのを待っています...")]):a("p",[e._v("接続しました！ホストがゲームを開始するのを待っています...")]),a("div",{staticClass:"players-list"},[e.roomData&&e.roomData.players?a("div",[e.roomData.players.player1?a("div",{staticClass:"player-item"},[a("span",[e._v("👻 "+e._s(e.roomData.players.player1.name))]),e.roomData.players.player1.connected?a("span",{staticClass:"status-connected"},[e._v("●")]):e._e()]):e._e(),e.roomData.players.player2?a("div",{staticClass:"player-item"},[a("span",[e._v("👻 "+e._s(e.roomData.players.player2.name))]),e.roomData.players.player2.connected?a("span",{staticClass:"status-connected"},[e._v("●")]):e._e()]):a("div",{staticClass:"player-item empty"},[a("span",[e._v("Player 2 を待っています...")])])]):e._e()]),e.canStartGame?a("button",{staticClass:"control options",on:{click:e.startGame}},[e._v("Start Game")]):e._e(),a("button",{staticClass:"control options back-btn",on:{click:e.leaveRoom}},[e._v("Leave Room")])]):e._e(),"connecting"===e.state?a("div",{staticClass:"connecting"},[a("h2",[e._v("Establishing Connection...")]),a("p",[e._v("Setting up peer-to-peer connection via WebRTC")]),a("div",{staticClass:"spinner"})]):e._e()])])},Ve=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",{staticClass:"info-text"},[e._v("あなたは "),a("strong",[e._v("Player 1")]),e._v(" (ホスト) になります")])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",{staticClass:"info-text"},[e._v("You will be "),a("strong",[e._v("Player 2")]),e._v(" (Guest)")])}],Ze=a("6bde"),et=(a("a481"),a("7e5f")),tt=a("2b51"),at={name:"Lobby",data:function(){return{state:"menu",roomCodeInput:"",currentRoomCode:null,isHost:!1,error:null,roomData:null,currentRoomData:null,webrtcConnected:!1,webrtcInitialized:!1,otherPlayerWasConnected:!1,webrtcConnectedAt:null}},computed:{canStartGame:function(){if(!this.roomData)return!1;var e=this.roomData.players&&this.roomData.players.player1,t=this.roomData.players&&this.roomData.players.player2;return this.isHost&&e&&t}},methods:{showCreateRoom:function(){this.state="create",this.error=null},showJoinRoom:function(){this.state="join",this.error=null},backToMenu:function(){this.state="menu",this.error=null,this.roomCodeInput=""},validateRoomCode:function(){this.roomCodeInput=this.roomCodeInput.replace(/\D/g,"").slice(0,5)},createRoom:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,a,n,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.error=null,t="Player 1",e.next=5,et["default"].createRoom(t);case 5:a=e.sent,n=a.roomCode,r=a.playerId,this.currentRoomCode=n,this.isHost=!0,this.state="waiting",et["default"].onRoomUpdate(this.handleRoomUpdate),this.$store.dispatch("setMultiplayerInfo",{isMultiplayer:!0,isHost:!0,playerId:r,roomCode:n,playerName:t}),e.next=19;break;case 15:e.prev=15,e.t0=e["catch"](0),this.error=e.t0.message,console.error("Error creating room:",e.t0);case 19:case"end":return e.stop()}},e,this,[[0,15]])}));return function(){return e.apply(this,arguments)}}(),joinRoom:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,a,n,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.error=null,t="Player 2",e.next=5,et["default"].joinRoom(this.roomCodeInput,t);case 5:a=e.sent,n=a.roomCode,r=a.playerId,this.currentRoomCode=n,this.isHost=!1,this.state="waiting",et["default"].onRoomUpdate(this.handleRoomUpdate),this.$store.dispatch("setMultiplayerInfo",{isMultiplayer:!0,isHost:!1,playerId:r,roomCode:n,playerName:t}),e.next=19;break;case 15:e.prev=15,e.t0=e["catch"](0),this.error=e.t0.message,console.error("Error joining room:",e.t0);case 19:case"end":return e.stop()}},e,this,[[0,15]])}));return function(){return e.apply(this,arguments)}}(),handleRoomUpdate:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var a,n,r,o,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.roomData=t,a=15e3,n=this.webrtcConnectedAt?Date.now()-this.webrtcConnectedAt:1/0,!("connecting"!==this.state&&this.webrtcConnected&&n>a)){e.next=51;break}if(this.isHost?"player1":"player2",r=this.isHost?"player2":"player1",!t.players||!t.players[r]){e.next=30;break}if(o=t.players[r].connected,!this.otherPlayerWasConnected||o){e.next=27;break}return console.log("⚠️ Other player disconnected"),tt["default"].destroy(),e.next=13,et["default"].disconnect();case 13:if(!this.isHost){e.next=16;break}return e.next=16,et["default"].deleteRoom();case 16:return this.$store.dispatch("resetMultiplayer"),this.error="接続が切断されました",this.state="menu",this.webrtcConnected=!1,this.webrtcInitialized=!1,this.currentRoomCode=null,this.isHost=!1,this.otherPlayerWasConnected=!1,this.webrtcConnectedAt=null,"play"===this.$store.state.mode&&this.$store.dispatch("mode","lobby"),e.abrupt("return");case 27:o&&(this.otherPlayerWasConnected=!0),e.next=49;break;case 30:if(!this.otherPlayerWasConnected||!t.players){e.next=49;break}return console.log("⚠️ Other player disconnected (removed from room)"),tt["default"].destroy(),e.next=35,et["default"].disconnect();case 35:if(!this.isHost){e.next=38;break}return e.next=38,et["default"].deleteRoom();case 38:return this.$store.dispatch("resetMultiplayer"),this.error="接続が切断されました",this.state="menu",this.webrtcConnected=!1,this.webrtcInitialized=!1,this.currentRoomCode=null,this.isHost=!1,this.otherPlayerWasConnected=!1,this.webrtcConnectedAt=null,"play"===this.$store.state.mode&&this.$store.dispatch("mode","lobby"),e.abrupt("return");case 49:e.next=52;break;case 51:t.players&&(i=this.isHost?"player2":"player1",t.players[i]&&t.players[i].connected&&(this.otherPlayerWasConnected=!0));case 52:if(!(t.players.player1&&t.players.player2&&t.players.player1.role&&t.players.player2.role&&"ready"===t.gameState.status)||this.webrtcInitialized){e.next=56;break}return this.webrtcInitialized=!0,e.next=56,this.initWebRTC(t);case 56:this.$store.dispatch("updateMultiplayerRoom",t);case 57:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),initWebRTC:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var n,r,o,c,l,u=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.state="connecting",this.currentRoomData=t,n=this.$store,e.prev=3,e.next=6,new Promise(function(e){return setTimeout(e,500)});case 6:this.isHost?(console.log("Initializing as host (initiator)"),tt["default"].initAsInitiator()):(console.log("Initializing as guest (receiver)"),tt["default"].initAsReceiver()),tt["default"].onSignal(function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("Sending signal:",t.type||"candidate"),a=function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var a,n,r,o,i=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=i.length>1&&void 0!==i[1]?i[1]:3,n=regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t();case 3:return e.abrupt("return",{v:void 0});case 6:if(e.prev=6,e.t0=e["catch"](0),console.error("Error sending signal (attempt ".concat(n+1,"/").concat(a,"):"),e.t0),!(n<a-1)){e.next=12;break}return e.next=12,new Promise(function(e){return setTimeout(e,1e3*(n+1))});case 12:case"end":return e.stop()}},e,this,[[0,6]])}),r=0;case 3:if(!(r<a)){e.next=11;break}return e.delegateYield(n(r),"t0",5);case 5:if(o=e.t0,"object"!==Object(Ze["a"])(o)){e.next=8;break}return e.abrupt("return",o.v);case 8:r++,e.next=3;break;case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),e.prev=2,"offer"!==t.type){e.next=8;break}return e.next=6,a(function(){return et["default"].setRTCOffer(t)});case 6:e.next=15;break;case 8:if("answer"!==t.type){e.next=13;break}return e.next=11,a(function(){return et["default"].setRTCAnswer(t)});case 11:e.next=15;break;case 13:return e.next=15,a(function(){return et["default"].addICECandidate(t)});case 15:e.next=20;break;case 17:e.prev=17,e.t0=e["catch"](2),console.error("Failed to send signal after retries:",e.t0);case 20:case"end":return e.stop()}},e,this,[[2,17]])}));return function(t){return e.apply(this,arguments)}}()),this.isHost?(console.log("Host: Waiting for answer..."),et["default"].roomRef.child("players/player2/rtcAnswer").on("value",function(e){var t=e.val();if(t){console.log("Host: Received answer, signaling...");try{tt["default"].signal(t)}catch(e){console.error("Error processing answer:",e)}}}),r=[],o=null,et["default"].roomRef.child("players/player2/iceCandidates").on("child_added",function(e){var t=e.val();t&&(console.log("Host: Received ICE candidate"),r.push(t),o&&clearTimeout(o),o=setTimeout(function(){r.forEach(function(e){try{tt["default"].signal(e)}catch(e){console.error("Error processing ICE candidate:",e)}}),r=[]},100))})):(console.log("Guest: Waiting for offer..."),et["default"].roomRef.child("players/player1/rtcOffer").on("value",function(e){var t=e.val();if(t){console.log("Guest: Received offer, signaling...");try{tt["default"].signal(t)}catch(e){console.error("Error processing offer:",e)}}}),c=[],l=null,et["default"].roomRef.child("players/player1/iceCandidates").on("child_added",function(e){var t=e.val();t&&(console.log("Guest: Received ICE candidate"),c.push(t),l&&clearTimeout(l),l=setTimeout(function(){c.forEach(function(e){try{tt["default"].signal(e)}catch(e){console.error("Error processing ICE candidate:",e)}}),c=[]},100))})),tt["default"].onConnected(function(){if(console.log("✅ WebRTC connection established!"),u.webrtcConnected=!0,u.webrtcConnectedAt=Date.now(),n.dispatch("setWebRTCConnected",!0),u.currentRoomData&&u.currentRoomData.players){var e=u.isHost?"player2":"player1";u.currentRoomData.players[e]&&u.currentRoomData.players[e].connected&&(u.otherPlayerWasConnected=!0)}var t=u.isHost?"player1":"player2",r=u.currentRoomData.players[t],o=u.currentRoomData.players.player1,s=u.currentRoomData.players.player2,c="player"===o.role?o.character:s.character;n.dispatch("setPlayerRole",r.role),n.commit("selectCharacter",r.character),n.commit("setMultiplayerInfo",Object(i["a"])({},n.state.multiplayer,{activePlayerCharacter:c})),"player"===r.role?(n.dispatch("startLevel",0),n.dispatch("mode","play"),setTimeout(function(){var e=a("2b51").default;console.log("📤 Player sending initialSync with candyHouseIndex:",n.state.candyHouseIndex),console.log("📤 Full initialSync data:",{type:"initialSync",level:0,candyHouseIndex:n.state.candyHouseIndex,map:n.state.map?"map exists":"no map",score:n.state.score,facing:n.state.facing}),e.sendGameState({type:"initialSync",level:0,candyHouseIndex:n.state.candyHouseIndex,map:n.state.map,score:n.state.score,facing:n.state.facing,activePlayerCharacter:n.state.multiplayer.activePlayerCharacter})},500)):n.dispatch("mode","play")}),tt["default"].onMessage(function(e){console.log("🎯 Lobby: Message callback triggered"),n.dispatch("handleMultiplayerMessage",e)}),tt["default"].onDisconnected(function(){u.webrtcConnected=!1,n.dispatch("setWebRTCConnected",!1)}),setTimeout(function(){if(!u.webrtcConnected&&"connecting"===u.state){console.log("⚠️ WebRTC timeout after 30s - starting without P2P");var e=u.isHost?"player1":"player2",t=u.currentRoomData.players[e],a=u.currentRoomData.players.player1,r=u.currentRoomData.players.player2,o="player"===a.role?a.character:r.character;n.dispatch("setPlayerRole",t.role),n.commit("selectCharacter",t.character),n.commit("setMultiplayerInfo",Object(i["a"])({},n.state.multiplayer,{activePlayerCharacter:o})),t.role,n.dispatch("startLevel",0),n.dispatch("mode","play")}},3e4),e.next=19;break;case 15:e.prev=15,e.t0=e["catch"](3),console.error("Error initializing WebRTC:",e.t0),this.error="Connection setup failed: "+e.t0.message;case 19:case"end":return e.stop()}},e,this,[[3,15]])}));return function(t){return e.apply(this,arguments)}}(),startGame:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.canStartGame){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,et["default"].assignRolesAndCharacters();case 5:e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](2),console.error("Error starting game:",e.t0),this.error="Failed to start game";case 11:case"end":return e.stop()}},e,this,[[2,7]])}));return function(){return e.apply(this,arguments)}}(),leaveRoom:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,et["default"].disconnect();case 2:if(!this.isHost){e.next=5;break}return e.next=5,et["default"].deleteRoom();case 5:tt["default"].destroy(),this.$store.dispatch("resetMultiplayer"),this.backToMenu();case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),handleDisconnection:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return tt["default"].destroy(),e.next=3,et["default"].disconnect();case 3:if(!this.isHost){e.next=6;break}return e.next=6,et["default"].deleteRoom();case 6:this.$store.dispatch("resetMultiplayer"),this.error="接続が切断されました",this.state="menu",this.webrtcConnected=!1,this.webrtcInitialized=!1,this.currentRoomCode=null,this.isHost=!1,"play"===this.$store.state.mode&&this.$store.dispatch("mode","lobby");case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},beforeDestroy:function(){et["default"].disconnect(),this.webrtcConnected?console.log("Lobby destroyed, keeping WebRTC alive for game"):(console.log("Lobby destroyed, cleaning up WebRTC (not connected)"),tt["default"].destroy())}},nt=at,rt=(a("a8ab"),Object(p["a"])(nt,Ke,Ve,!1,null,"538904ea",null));rt.options.__file="Lobby.vue";var ot=rt.exports,it=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.overlayActive?a("div",{staticClass:"interaction-overlay"},[a("div",{staticClass:"overlay-content"},[a("h1",{staticClass:"overlay-message"},[e._v(e._s(e.overlayMessage))]),a("div",{ref:"animationContainer",staticClass:"animation-container"})])]):e._e()},st=[],ct=a("94f1"),lt=a.n(ct),ut={name:"InteractionOverlay",data:function(){return{animation:null}},computed:Object(i["a"])({},Object(c["b"])(["overlayActive","overlayType","overlayMessage"])),watch:{overlayActive:function(e){var t=this;e?this.$nextTick(function(){t.loadAnimation()}):this.cleanup()}},methods:{loadAnimation:function(){if(this.$refs.animationContainer){var e="success"===this.overlayType?"lottie/candy.json":"lottie/homework.json";this.animation=lt.a.loadAnimation({container:this.$refs.animationContainer,renderer:"svg",loop:!0,autoplay:!0,path:e})}},cleanup:function(){this.animation&&(this.animation.destroy(),this.animation=null)}},beforeDestroy:function(){this.cleanup()}},dt=ut,ht=(a("4d5c"),Object(p["a"])(dt,it,st,!1,null,"98180e24",null));ht.options.__file="InteractionOverlay.vue";var pt=ht.exports,mt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"directions-helper"},[e._m(0),a("div",{staticClass:"helper-content"},[a("div",{staticClass:"direction-item"},[a("img",{staticClass:"icon",attrs:{src:e.baseUrl+"gostraight.png",alt:"Go straight"}}),e._m(1)]),a("div",{staticClass:"direction-item"},[a("img",{staticClass:"icon",attrs:{src:e.baseUrl+"gostraightlittle.png",alt:"Go straight a little"}}),e._m(2)]),a("div",{staticClass:"direction-item"},[a("img",{staticClass:"icon",attrs:{src:e.baseUrl+"turnright.png",alt:"Turn right"}}),e._m(3)]),a("div",{staticClass:"direction-item"},[a("img",{staticClass:"icon",attrs:{src:e.baseUrl+"turnleft.png",alt:"Turn left"}}),e._m(4)]),a("div",{staticClass:"direction-item"},[a("img",{staticClass:"icon",attrs:{src:e.baseUrl+"seeleft.png",alt:"See left"}}),e._m(5)]),a("div",{staticClass:"direction-item"},[a("img",{staticClass:"icon",attrs:{src:e.baseUrl+"seeright.png",alt:"See right"}}),e._m(6)])])])},ft=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"helper-header"},[a("h3",[e._v("方向の伝え方")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"text"},[e._v("Go straight for "),a("strong",[e._v("〇 block(s)")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"text"},[e._v("Go straight for "),a("strong",[e._v("a little bit")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"text"},[a("strong",[e._v("Turn right")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"text"},[a("strong",[e._v("Turn left")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"text"},[e._v("You can see it on your "),a("strong",[e._v("left")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"text"},[e._v("You can see it on your "),a("strong",[e._v("right")])])}],vt={name:"DirectionsHelper",computed:{baseUrl:function(){return"/trickortreat/"}}},yt=vt,gt=(a("e202"),Object(p["a"])(yt,mt,ft,!1,null,"06aac514",null));gt.options.__file="DirectionsHelper.vue";var bt=gt.exports,xt={name:"app",components:{CharacterSelect:We,Controls:C,LevelSelect:I,LevelWin:T,GameThree:He,MapEditor:Xe,Lobby:ot,InteractionOverlay:pt,DirectionsHelper:bt},data:function(){return{showQR:!1}},mounted:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.$store.dispatch("loadLevels"),et["default"].startPeriodicCleanup(10);case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),methods:{toggleQRCode:function(){this.showQR=!this.showQR}},computed:Object(i["a"])({},Object(c["b"])(["mode"]),{baseUrl:function(){return"/trickortreat/"},showQRButton:function(){return"lobby"===this.mode||"levelSelect"===this.mode}})},Ct=xt,wt=(a("5c0b"),Object(p["a"])(Ct,r,o,!1,null,null,null));wt.options.__file="App.vue";var _t=wt.exports,Mt=(a("f559"),a("c5f6"),a("7cdf"),a("0b21"),a("1c4c"),a("a322")),Rt=a("0284"),kt=a.n(Rt);n["a"].use(c["a"]);var It=function(e,t,a,n){return e.slice(0,t)+n+e.slice(t+a)},Pt=/[QWEDCXZAH]/gm,At={LEFT:"left",UP:"up",RIGHT:"right",DOWN:"down"},St=function(e){var t,a=(t={},Object(Mt["a"])(t,At.LEFT,At.DOWN),Object(Mt["a"])(t,At.DOWN,At.RIGHT),Object(Mt["a"])(t,At.RIGHT,At.UP),Object(Mt["a"])(t,At.UP,At.LEFT),t);return a[e]},Dt=function(e){var t,a=(t={},Object(Mt["a"])(t,At.LEFT,At.UP),Object(Mt["a"])(t,At.UP,At.RIGHT),Object(Mt["a"])(t,At.RIGHT,At.DOWN),Object(Mt["a"])(t,At.DOWN,At.LEFT),t);return a[e]},Ot={up:{dx:0,dy:-1},down:{dx:0,dy:1},left:{dx:-1,dy:0},right:{dx:1,dy:0}};function Tt(e,t,a){var n=Ot[a],r=e.pathNodes[t],o=Array.from(e.pathAdjacency[t]||[]),i=null,s=1/0;return o.forEach(function(t){var a=e.pathNodes[t],o=a.x-r.x,c=a.y-r.y;if(0!==n.dx){if(0===c&&Math.sign(o)===n.dx){var l=Math.abs(o);l>0&&l<s&&(s=l,i=t)}}else if(0===o&&Math.sign(c)===n.dy){var u=Math.abs(c);u>0&&u<s&&(s=u,i=t)}}),i}function Ht(e,t,a){var n=Ot[a],r=e.pathNodes[t],o=Array.from(e.pathAdjacency[t]||[]),i=!1;return o.forEach(function(t){var a=e.pathNodes[t],o=a.x-r.x,s=a.y-r.y,c=0!==n.dx&&Math.sign(o)===-n.dx&&0===s||0!==n.dy&&Math.sign(s)===-n.dy&&0===o;c||(0!==n.dx&&0===o&&0!==s&&(i=!0),0!==n.dy&&0===s&&0!==o&&(i=!0))}),i}var Et=function(e,t,a){var n=a+1;return 1+t*n+e},Lt=function(e,t){var a=t+1,n=e-1,r=Math.floor(n/a),o=n%a;return{x:o,y:r}},jt=function(e,t,a,n,r){var o=e,i=t;return"up"===r&&(i=Math.max(t-1,0)),"down"===r&&(i=Math.min(t+1,n)),"left"===r&&(o=Math.max(e-1,0)),"right"===r&&(o=Math.min(e+1,a)),{x:o,y:i}},Gt=function(e,t,a,n,r,o){var i=(e.match(/\n/g)||[]).length-1,s=jt(t,a,n,i,r);if(s.x===t&&s.y===a)return!1;var c=Et(s.x,s.y,n),l=e.charAt(c);return o.includes(l)||"!"===l},Nt=function(e,t,a,n,r,o){var i={up:["left","right"],down:["left","right"],left:["up","down"],right:["up","down"]},s=i[r]||[];return s.some(function(r){return Gt(e,t,a,n,r,o)})},Wt=function(e,t){var a={Q:["up","left"],W:["up"],E:["up","right"],D:["right"],C:["down","right"],X:["down"],Z:["down","left"],A:["left"],H:["up"]},n=a[e]||[];return n.includes(t)},$t=function(e,t,a,n,r){for(var o=(e.match(/\n/g)||[]).length-1,i=[{name:"up",dx:0,dy:-1},{name:"down",dx:0,dy:1},{name:"left",dx:-1,dy:0},{name:"right",dx:1,dy:0}],s={up:"down",down:"up",left:"right",right:"left"},c=0;c<i.length;c++){var l=i[c],u=Math.min(Math.max(t+l.dx,0),n),d=Math.min(Math.max(a+l.dy,0),o),h=Et(u,d,n),p=e.charAt(h);if(p&&p.match(Pt)){var m=s[l.name],f=Wt(p,m),v=r===l.name;if(f&&v)return{houseChar:p,houseIndex:h}}}return null},zt=function(e,t){var a=e.map,n=a.indexOf("\n",1)-1,r=(a.match(/\n/g)||[]).length-1,o=a.indexOf("G",1),i=Lt(o,n),s=i.x,c=i.y,l=s,u=c;"up"===t&&(u=Math.max(u-1,0)),"down"===t&&(u=Math.min(u+1,r)),"left"===t&&(l=Math.max(l-1,0)),"right"===t&&(l=Math.min(l+1,n));var d=Et(l,u,n),h=o,p=e.moves,m=e.score,f=a,v=a.charAt(d);if(e.roadTiles.includes(v)){h=d;var y=e.levels[e.currentLevel].charAt(o);f=It(f,o,1,y),f=It(f,h,1,"G")}if(e.charAtNewIndex&&e.charAtNewIndex.match(Pt)){var g=e.charAtNewIndex,b=Wt(g,t);if(b){m+=1;var x=d;f=It(f,x,1,g.toLocaleLowerCase())}}return h===o&&m===e.score||(p+=1),{charAtNewIndex:v,gIndexLast:o,newIndex:d,yLast:c,xLast:s,x:l,y:u,moves:p,score:m,map:f}},Ft=0,Ut=new c["a"].Store({state:{charAtNewIndex:null,lastDirection:null,facing:At.LEFT,moves:0,score:0,levels:[],levelMeta:[],pathNodes:[],pathEdges:[],pathAdjacency:{},currentNodeIdx:null,roadTiles:[],mode:"lobby",modePrevious:"lobby",character:null,currentLevel:null,map:null,candyHouseIndex:null,overlayActive:!1,overlayType:null,overlayMessage:null,lastInteractedHouseIndex:null,multiplayer:{isMultiplayer:!1,isHost:!1,playerId:null,roomCode:null,playerName:null,playerRole:null,otherPlayerName:null,otherPlayerRole:null,webrtcConnected:!1,roomData:null,activePlayerCharacter:null,otherPlayerWasConnected:!1,webrtcConnectedAt:null}},getters:{score:function(e){return e.score},moves:function(e){return e.moves},map:function(e){return e.map},mode:function(e){return e.mode},modePrevious:function(e){return e.modePrevious},character:function(e){return e.character},levels:function(e){return e.levels},levelMeta:function(e){return e.levelMeta},currentLevel:function(e){return e.currentLevel},candyHouseIndex:function(e){return e.candyHouseIndex},lastDirection:function(e){return e.lastDirection},facing:function(e){return e.facing},isMultiplayer:function(e){return e.multiplayer.isMultiplayer},isHost:function(e){return e.multiplayer.isHost},playerRole:function(e){return e.multiplayer.playerRole},isPlayer:function(e){return"player"===e.multiplayer.playerRole},isGuide:function(e){return"guide"===e.multiplayer.playerRole},webrtcConnected:function(e){return e.multiplayer.webrtcConnected},roomData:function(e){return e.multiplayer.roomData},playerId:function(e){return e.multiplayer.playerId},activePlayerCharacter:function(e){return e.multiplayer.activePlayerCharacter},overlayActive:function(e){return e.overlayActive},overlayType:function(e){return e.overlayType},overlayMessage:function(e){return e.overlayMessage},canTrickOrTreat:function(e){if(!e.map||e.overlayActive)return!1;var t=e.map.indexOf("G",1);if(t<0)return!1;var a=e.map.indexOf("\n",1)-1,n=Lt(t,a),r=n.x,o=n.y,i=$t(e.map,r,o,a,e.facing);return!!i&&i.houseIndex!==e.lastInteractedHouseIndex}},mutations:{setLevels:function(e,t){e.roadTiles=t.roadTiles,e.levels=t.levels,e.levelMeta=t.levelMeta||[]},startLevel:function(e,t){var a="object"===Object(Ze["a"])(t)?t.level:t,n="object"===Object(Ze["a"])(t)?t.candyHouseIndex:null,r="object"===Object(Ze["a"])(t)&&t.keepScore;if(e.currentLevel=a,e.map=e.levels.length?e.levels[e.currentLevel].replace("S","G"):null,r||(e.score=0),e.moves=0,e.facing=At.LEFT,e.lastInteractedHouseIndex=null,e.map)if(null!==n&&void 0!==n)e.candyHouseIndex=n,console.log("🍬 Candy house synced from other player:",n);else{var o=e.map.match(Pt);if(o&&o.length>0){for(var i=Math.floor(Math.random()*o.length),s=0,c=0;c<e.map.length;c++)if(e.map[c].match(Pt)){if(s===i){e.candyHouseIndex=c;var l=e.map.indexOf("\n",1)-1,u=Lt(c,l),d=u.x,h=u.y;console.log("🍬 Candy house selected:"),console.log("  stringIndex:",c),console.log("  position:",{x:d,y:h}),console.log("  char:",e.map[c]),console.log("  houseNumber:",i,"of",o.length);break}s++}}else e.candyHouseIndex=null}var p=e.levelMeta[a]||{nodes:[],edges:[]};e.pathNodes=Array.isArray(p.nodes)?p.nodes:[],e.pathEdges=Array.isArray(p.edges)?p.edges:[];var m={};e.pathNodes.forEach(function(e,t){m["".concat(e.x,",").concat(e.y)]=t});var f={},v=function(e,t){void 0!==e&&void 0!==t&&(f[e]||(f[e]=new Set),f[t]||(f[t]=new Set),f[e].add(t),f[t].add(e))};if(e.pathEdges.forEach(function(e){var t=m["".concat(e.from.x,",").concat(e.from.y)],a=m["".concat(e.to.x,",").concat(e.to.y)];v(t,a)}),e.pathAdjacency=f,e.map){var y=e.map.indexOf("\n",1)-1,g=e.map.indexOf("G",1);if(g>0){var b=Lt(g,y),x=b.x,C=b.y,w=m["".concat(x,",").concat(C)];e.currentNodeIdx=Number.isInteger(w)?w:null,console.log("Level loaded. Spawn at:",x,C,"Node index:",e.currentNodeIdx,"Total nodes:",e.pathNodes.length,"Total edges:",e.pathEdges.length),null===e.currentNodeIdx&&console.warn("⚠️ No node found at spawn point! Graph navigation will not work.")}else e.currentNodeIdx=null}},mode:function(e,t){e.modePrevious=e.mode,e.mode=t},selectCharacter:function(e,t){e.character=t},setMultiplayerInfo:function(e,t){e.multiplayer.isMultiplayer=t.isMultiplayer,e.multiplayer.isHost=t.isHost,e.multiplayer.playerId=t.playerId,e.multiplayer.roomCode=t.roomCode,e.multiplayer.playerName=t.playerName,void 0!==t.activePlayerCharacter&&(e.multiplayer.activePlayerCharacter=t.activePlayerCharacter)},setPlayerRole:function(e,t){e.multiplayer.playerRole=t},setWebRTCConnected:function(e,t){e.multiplayer.webrtcConnected=t,e.multiplayer.webrtcConnectedAt=t?Date.now():null},setOtherPlayerConnected:function(e,t){e.multiplayer.otherPlayerWasConnected=t},updateMultiplayerRoom:function(e,t){e.multiplayer.roomData=t;var a="player1"===e.multiplayer.playerId?"player2":"player1";t.players&&t.players[a]&&(e.multiplayer.otherPlayerName=t.players[a].name,e.multiplayer.otherPlayerRole=t.players[a].role)},syncGameState:function(e,t){void 0!==t.map&&(e.map=t.map),void 0!==t.score&&(e.score=t.score),void 0!==t.moves&&(e.moves=t.moves),void 0!==t.facing&&(e.facing=t.facing),void 0!==t.lastDirection&&(e.lastDirection=t.lastDirection),void 0!==t.charAtNewIndex&&(e.charAtNewIndex=t.charAtNewIndex),void 0!==t.candyHouseIndex&&(console.log("🔄 Syncing candyHouseIndex:",t.candyHouseIndex,"was:",e.candyHouseIndex),e.candyHouseIndex=t.candyHouseIndex),void 0!==t.activePlayerCharacter&&(e.multiplayer.activePlayerCharacter=t.activePlayerCharacter)},resetMultiplayer:function(e){e.multiplayer={isMultiplayer:!1,isHost:!1,playerId:null,roomCode:null,playerName:null,playerRole:null,otherPlayerName:null,otherPlayerRole:null,webrtcConnected:!1,roomData:null,activePlayerCharacter:null,otherPlayerWasConnected:!1,webrtcConnectedAt:null}},setOverlay:function(e,t){e.overlayActive=!!t.active,e.overlayType=t.type||null,e.overlayMessage=t.message||null},move:function(e,t){if(!e.overlayActive){var n=t,r=e.map.indexOf("\n",1)-1;if(Number.isInteger(e.currentNodeIdx)&&e.pathNodes[e.currentNodeIdx]){var o=e.pathNodes[e.currentNodeIdx],i=Array.from(e.pathAdjacency[e.currentNodeIdx]||[]),s={up:{dx:0,dy:-1},down:{dx:0,dy:1},left:{dx:-1,dy:0},right:{dx:1,dy:0}}[n],c=null,l=1/0;if(i.forEach(function(t){var a=e.pathNodes[t],n=a.x-o.x,r=a.y-o.y;if(0!==s.dx){if(0===r&&Math.sign(n)===s.dx){var i=Math.abs(n);i>0&&i<l&&(l=i,c=t)}}else if(0===n&&Math.sign(r)===s.dy){var u=Math.abs(r);u>0&&u<l&&(l=u,c=t)}}),null!==c){var u=Et(e.pathNodes[c].x,e.pathNodes[c].y,r),d=e.map.indexOf("G",1),h=e.levels[e.currentLevel].charAt(d),p=It(It(e.map,d,1,h),u,1,"G");e.map=p,e.lastDirection=n,e.facing=n,e.currentNodeIdx=c}else e.moves+=1}else{var m=zt(e,n);e.lastDirection=n,e.map=m.map,e.score=m.score,e.moves=m.moves,e.charAtNewIndex=m.charAtNewIndex}if(e.multiplayer.isMultiplayer&&e.multiplayer.webrtcConnected){var f=a("2b51").default,v={map:e.map,score:e.score,facing:e.facing,candyHouseIndex:e.candyHouseIndex,activePlayerCharacter:e.multiplayer.activePlayerCharacter};console.log("Sending game state (move):",v),f.sendGameState(v)}}},turnLeftMutation:function(e){if(!e.overlayActive&&(e.facing=St(e.facing),e.lastDirection=e.facing,e.moves+=1,e.lastInteractedHouseIndex=null,e.multiplayer.isMultiplayer&&e.multiplayer.webrtcConnected)){var t=a("2b51").default,n={facing:e.facing,lastDirection:e.lastDirection,map:e.map,score:e.score,candyHouseIndex:e.candyHouseIndex,activePlayerCharacter:e.multiplayer.activePlayerCharacter};console.log("Sending game state (turn left):",n),t.sendGameState(n)}},turnRightMutation:function(e){if(!e.overlayActive&&(e.facing=Dt(e.facing),e.lastDirection=e.facing,e.moves+=1,e.lastInteractedHouseIndex=null,e.multiplayer.isMultiplayer&&e.multiplayer.webrtcConnected)){var t=a("2b51").default,n={facing:e.facing,lastDirection:e.lastDirection,map:e.map,score:e.score,candyHouseIndex:e.candyHouseIndex,activePlayerCharacter:e.multiplayer.activePlayerCharacter};console.log("Sending game state (turn right):",n),t.sendGameState(n)}},moveForward:function(e){if(!e.overlayActive)if(Number.isInteger(e.currentNodeIdx)&&e.pathNodes[e.currentNodeIdx]){var t=e.map.indexOf("\n",1)-1,n=e.currentNodeIdx,r=!1;while(1){var o=Tt(e,n,e.facing);if(null===o)break;var i=Et(e.pathNodes[o].x,e.pathNodes[o].y,t),s=e.map.indexOf("G",1),c=e.levels[e.currentLevel].charAt(s);e.map=It(It(e.map,s,1,c),i,1,"G"),e.moves+=1,r=!0,n=o;var l=e.pathNodes[n];if("junction"===l.type||"both"===l.type)break;if(Ht(e,n,e.facing))break}if(e.currentNodeIdx=n,r||(e.moves+=1),e.multiplayer.isMultiplayer&&e.multiplayer.webrtcConnected){var u=a("2b51").default;u.sendGameState({map:e.map,score:e.score,facing:e.facing,candyHouseIndex:e.candyHouseIndex,activePlayerCharacter:e.multiplayer.activePlayerCharacter})}}else{var d=e.map,h=d.indexOf("\n",1)-1,p=d.indexOf("G",1),m=Math.floor((p-1)/(h+1)),f=(p-m)%h,v=f,y=m;while(Gt(e.map,v,y,h,e.facing,e.roadTiles)){var g=zt(e,e.facing);e.lastDirection=e.facing,e.map=g.map,e.score=g.score,e.moves=g.moves,e.charAtNewIndex=g.charAtNewIndex;var b=e.map.indexOf("G",1),x=Lt(b,h),C=x.x,w=x.y;if(Nt(e.map,C,w,h,e.facing,e.roadTiles))break;v=C,y=w}if(e.multiplayer.isMultiplayer&&e.multiplayer.webrtcConnected){var _=a("2b51").default,M={map:e.map,score:e.score,facing:e.facing,lastDirection:e.lastDirection,charAtNewIndex:e.charAtNewIndex,candyHouseIndex:e.candyHouseIndex,activePlayerCharacter:e.multiplayer.activePlayerCharacter};console.log("Sending game state (move forward):",M),_.sendGameState(M)}}},shortForward:function(e){if(!e.overlayActive)if(Number.isInteger(e.currentNodeIdx)&&e.pathNodes[e.currentNodeIdx]){var t=e.map.indexOf("\n",1)-1,n=e.candyHouseIndex,r=e.currentNodeIdx,o=null,i=null;while(1){var s=Tt(e,r,e.facing);if(null===s)break;var c=e.pathNodes[s];if("junction"===c.type)break;if("houseStop"!==c.type&&"both"!==c.type||null!==i||(i=s),"houseStop"===c.type||"both"===c.type){for(var l=c.x,u=c.y,d=[{nx:l-1,ny:u},{nx:l+1,ny:u},{nx:l,ny:u-1},{nx:l,ny:u+1}],h=0;h<d.length;h++){var p=d[h],m=p.nx,f=p.ny,v=(e.map.match(/\n/g)||[]).length-1;if(m>=0&&m<=t&&f>=0&&f<=v){var y=Et(m,f,t);if(y===n){o=s;break}}}if(null!==o)break}r=s}if(null===o&&(o=i),null!==o){var g=e.currentNodeIdx;while(g!==o){var b=Tt(e,g,e.facing);if(null===b)break;var x=Et(e.pathNodes[b].x,e.pathNodes[b].y,t),C=e.map.indexOf("G",1),w=e.levels[e.currentLevel].charAt(C);e.map=It(It(e.map,C,1,w),x,1,"G"),e.moves+=1,!0,g=b}e.currentNodeIdx=g}if(e.multiplayer.isMultiplayer&&e.multiplayer.webrtcConnected){var _=a("2b51").default;_.sendGameState({map:e.map,score:e.score,facing:e.facing,candyHouseIndex:e.candyHouseIndex,activePlayerCharacter:e.multiplayer.activePlayerCharacter})}}else{var M=e.map,R=M.indexOf("\n",1)-1,k=(M.match(/\n/g)||[]).length-1,I=M.indexOf("G",1),P=Math.floor((I-1)/(R+1)),A=(I-P)%R,S=A,D=P,O=function(t,a){for(var n="up"===e.facing||"down"===e.facing?["left","right"]:["up","down"],r=0;r<n.length;r++){var o=n[r],i=jt(t,a,R,k,o),s=Et(i.x,i.y,R),c=e.map.charAt(s);if(c.match(Pt)||c.match(/[qwedcxzah]/i))return!0}return!1};while(Gt(e.map,S,D,R,e.facing,e.roadTiles)){var T=zt(e,e.facing);e.lastDirection=e.facing,e.map=T.map,e.score=T.score,e.moves=T.moves,e.charAtNewIndex=T.charAtNewIndex,!0;var H=e.map.indexOf("G",1),E=Lt(H,R),L=E.x,j=E.y;if(O(L,j))break;S=L,D=j}if(e.multiplayer.isMultiplayer&&e.multiplayer.webrtcConnected){var G=a("2b51").default,N={map:e.map,score:e.score,facing:e.facing,lastDirection:e.lastDirection,charAtNewIndex:e.charAtNewIndex,candyHouseIndex:e.candyHouseIndex,activePlayerCharacter:e.multiplayer.activePlayerCharacter};console.log("Sending game state (short forward):",N),G.sendGameState(N)}}}},actions:{loadLevels:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var a,n,r,o,i,s,c;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=t.dispatch,e.next=3,fetch("./levels.txt");case 3:return n=e.sent,e.next=6,n.text();case 6:r=e.sent.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),o=r.split("\n\n"),i=Object(L["a"])(o.shift()),s=[],c=[],o.forEach(function(e){if(e.trim())if(e.trim().startsWith("---META---")){if(s.length>0)try{var t=e.split("---META---")[1].trim(),a=JSON.parse(t);c[c.length-1]=a}catch(e){console.error("Failed to parse orphaned metadata:",e)}}else{var n=e.split("\n---META---\n"),r=n[0].trim(),o=n[1];if(r.trim())if(s.push("\n"+r),o)try{c.push(JSON.parse(o))}catch(e){console.error("Failed to parse metadata:",e),c.push({nodes:[],edges:[]})}else c.push({nodes:[],edges:[]})}}),console.log("📦 Loaded levels:",s.length,"levels with",c.length,"metadata entries"),c.forEach(function(e,t){console.log("Level ".concat(t,": ").concat(e.nodes?e.nodes.length:0," nodes, ").concat(e.edges?e.edges.length:0," edges"))}),a("setLevels",{roadTiles:i,levels:s,levelMeta:c});case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),setLevels:function(e,t){var a=e.commit;a("setLevels",t)},setMultiplayerMode:function(e,t){var a=e.commit;t||a("resetMultiplayer")},selectCharacter:function(e,t){var a=e.state,n=e.commit;n("selectCharacter",t),a.multiplayer.isMultiplayer||(n("startLevel",0),n("mode","play")),Object(Rt["event"])("interaction","selectCharacter",t,null)},startLevel:function(e,t){var a=e.state,n=e.commit;n("startLevel",t),n("mode","play"),Object(Rt["event"])("interaction","startLevel",null,a.currentLevel)},mode:function(e,t){e.state;var a=e.commit;a("mode",t),Object(Rt["event"])("interaction","mode",t,null)},nextLevel:function(e){var t=e.state,a=e.commit,n=(t.currentLevel+1)%t.levels.length;a("startLevel",n),a("mode","play"),Object(Rt["event"])("interaction","nextLevel",null,t.currentLevel)},move:function(e,t){var n=e.state,r=e.commit;if(!n.multiplayer.isMultiplayer||"player"===n.multiplayer.playerRole){r("move",t);var o=!n.map.match(Pt),i="!"===n.charAtNewIndex;(o||i)&&(Ft+=1,Object(Rt["event"])("interaction","win","currentLevel: ".concat(n.currentLevel,", score: ").concat(n.score,", moves: ").concat(n.moves),Ft),Object(Rt["event"])("interaction","winMap",n.map,o?1:0),setTimeout(function(){if(r("mode","levelWin"),n.multiplayer.isMultiplayer&&n.multiplayer.webrtcConnected){var e=a("2b51").default;e.sendGameState({type:"levelWin",map:n.map,score:n.score,facing:n.facing,candyHouseIndex:n.candyHouseIndex,activePlayerCharacter:n.multiplayer.activePlayerCharacter})}},200))}},turnLeftAction:function(e){var t=e.state,a=e.commit;t.multiplayer.isMultiplayer&&"player"!==t.multiplayer.playerRole||(a("turnLeftMutation"),Object(Rt["event"])("interaction","turnLeft",t.facing,null))},turnRightAction:function(e){var t=e.state,a=e.commit;t.multiplayer.isMultiplayer&&"player"!==t.multiplayer.playerRole||(a("turnRightMutation"),Object(Rt["event"])("interaction","turnRight",t.facing,null))},forward:function(e){var t=e.state,n=e.commit;if(!t.multiplayer.isMultiplayer||"player"===t.multiplayer.playerRole){n("moveForward");var r=!t.map.match(Pt),o="!"===t.charAtNewIndex;(r||o)&&(Ft+=1,Object(Rt["event"])("interaction","win","currentLevel: ".concat(t.currentLevel,", score: ").concat(t.score,", moves: ").concat(t.moves),Ft),Object(Rt["event"])("interaction","winMap",t.map,r?1:0),setTimeout(function(){if(n("mode","levelWin"),t.multiplayer.isMultiplayer&&t.multiplayer.webrtcConnected){var e=a("2b51").default;e.sendGameState({type:"levelWin",map:t.map,score:t.score,facing:t.facing,candyHouseIndex:t.candyHouseIndex,activePlayerCharacter:t.multiplayer.activePlayerCharacter})}},200))}},shortForwardAction:function(e){var t=e.state,n=e.commit;if(!t.multiplayer.isMultiplayer||"player"===t.multiplayer.playerRole){n("shortForward");var r=!t.map.match(Pt),o="!"===t.charAtNewIndex;(r||o)&&(Ft+=1,Object(Rt["event"])("interaction","win","currentLevel: ".concat(t.currentLevel,", score: ").concat(t.score,", moves: ").concat(t.moves),Ft),Object(Rt["event"])("interaction","winMap",t.map,r?1:0),setTimeout(function(){if(n("mode","levelWin"),t.multiplayer.isMultiplayer&&t.multiplayer.webrtcConnected){var e=a("2b51").default;e.sendGameState({type:"levelWin",map:t.map,score:t.score,facing:t.facing,candyHouseIndex:t.candyHouseIndex,activePlayerCharacter:t.multiplayer.activePlayerCharacter})}},200))}},testCustomMap:function(e,t){var a=e.state,n=e.commit,r=a.levels.length;a.levels.push(t),n("startLevel",r),n("mode","play"),Object(Rt["event"])("interaction","testCustomMap",null,null)},setMultiplayerInfo:function(e,t){var a=e.commit;a("setMultiplayerInfo",t)},setPlayerRole:function(e,t){var a=e.commit;a("setPlayerRole",t)},setWebRTCConnected:function(e,t){var a=e.commit;a("setWebRTCConnected",t)},updateMultiplayerRoom:function(e,t){var n=e.commit,r=e.state,o=e.dispatch;if(n("updateMultiplayerRoom",t),r.multiplayer.isMultiplayer&&"play"===r.mode&&r.multiplayer.webrtcConnected&&t&&t.players){var i=r.multiplayer.playerId,s="player1"===i?"player2":"player1",c=t.players[s];!r.multiplayer.otherPlayerWasConnected&&c&&c.connected&&n("setOtherPlayerConnected",!0);var l=3e3,u=r.multiplayer.webrtcConnectedAt?Date.now()-r.multiplayer.webrtcConnectedAt:1/0;if(u>l&&r.multiplayer.otherPlayerWasConnected){var d=!c||!c.connected;if(d){console.log("⚠️ Other player disconnected during gameplay");var h=a("2b51").default,p=a("7e5f").default;h.destroy(),p.disconnect().then(function(){r.multiplayer.isHost&&p.deleteRoom()}),o("resetMultiplayer"),o("mode","lobby"),setTimeout(function(){alert("接続が切断されました")},100)}}}},handleMultiplayerMessage:function(e,t){var a=e.commit,n=e.state,r=e.dispatch;if(console.log("📥 Received multiplayer message:",t.type,t.data),"gameState"===t.type)if("initialSync"===t.data.type){console.log("📥 Guide received initial sync with candyHouseIndex:",t.data.candyHouseIndex),console.log("📥 Levels loaded:",n.levels.length,"levels");var o=void 0!==t.data.level?t.data.level:0,i=t.data.candyHouseIndex;void 0!==i?(console.log("📥 Starting level",o,"with candyHouseIndex:",i),a("startLevel",{level:o,candyHouseIndex:i})):(console.log("📥 Starting level",o,"without candyHouseIndex"),a("startLevel",o)),a("syncGameState",t.data),a("mode","play"),console.log("📥 Guide map loaded:",n.map?"map exists":"no map","mode set to play")}else if("roleSwitch"===t.data.type)console.log("📥 Guide received roleSwitch, score in message:",t.data.score),a("setOverlay",{active:!1,type:null,message:null}),void 0!==t.data.score&&(n.score=t.data.score,console.log("📥 Score synced to:",n.score)),r("switchRolesAndContinue");else if("levelWin"===t.data.type)console.log("Received level win notification:",t.data),a("syncGameState",t.data);else if("houseInteraction"===t.data.type){if(console.log("Received house interaction:",t.data),"guide"!==n.multiplayer.playerRole)return void console.log("Ignoring houseInteraction - not guide role");a("syncGameState",t.data),t.data.success?a("setOverlay",{active:!0,type:"success",message:"Good Job! You got candy!"}):(a("setOverlay",{active:!0,type:"fail",message:"Oh no! You got homework!"}),setTimeout(function(){a("setOverlay",{active:!1,type:null,message:null})},5e3))}else if("levelStart"===t.data.type){console.log("📥 Guide received levelStart with candyHouseIndex:",t.data.candyHouseIndex,"score:",t.data.score);var s=void 0!==t.data.level?t.data.level:n.currentLevel,c=t.data.candyHouseIndex;void 0!==t.data.score&&(n.score=t.data.score,console.log("📥 Score synced to:",n.score)),a("startLevel",void 0!==c?{level:s,candyHouseIndex:c,keepScore:!0}:{level:s,keepScore:!0}),a("syncGameState",t.data),console.log("📥 Final score after sync:",n.score)}else console.log("Received game state update:",t.data),a("syncGameState",t.data)},resetMultiplayer:function(e){var t=e.commit;t("resetMultiplayer")},switchRolesAndContinue:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var n,r,o,i,s,c,l,u,d,h;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=t.state,r=t.commit,console.log("🔄 switchRolesAndContinue called, current role:",n.multiplayer.playerRole),o=n.multiplayer.playerRole,i="player"===o?"guide":"player",console.log("🔄 Switching from",o,"to",i),s=n.multiplayer.activePlayerCharacter,c="ghost"===s?"alien":"ghost",l=(n.currentLevel+1)%n.levels.length,"player"===o?(console.log("🔄 I was the player, sending roleSwitch to guide first, current score:",n.score),n.multiplayer.webrtcConnected&&(u=a("2b51").default,console.log("📤 Sending roleSwitch message to guide with score:",n.score),u.sendGameState({type:"roleSwitch",activePlayerCharacter:c,level:l,score:n.score})),r("setPlayerRole",i),n.multiplayer.activePlayerCharacter=c,console.log("🔄 I am now the guide, keeping score:",n.score)):(console.log("🔄 I was the guide, becoming player"),r("setPlayerRole",i),n.multiplayer.activePlayerCharacter=c,d=n.score,console.log("🔄 Starting level",l,"as new player, score before startLevel:",d),r("startLevel",{level:l,keepScore:!0}),console.log("🔄 Score after startLevel:",n.score,"(should be",d,")"),n.multiplayer.webrtcConnected&&(h=a("2b51").default,console.log("📤 Sending levelStart with candyHouseIndex:",n.candyHouseIndex,"score:",n.score),h.sendGameState({type:"levelStart",level:l,candyHouseIndex:n.candyHouseIndex,map:n.map,score:n.score,facing:n.facing,activePlayerCharacter:n.multiplayer.activePlayerCharacter}))),r("mode","play"),console.log("🔄 switchRolesAndContinue complete, mode set to play");case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),trickOrTreat:function(e){var t=e.dispatch;t("interactWithHouse")},interactWithHouse:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var n,r,o,i,s,c,l,u,d,h,p,m,f,v,y,g,b,x,C;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.state,r=t.commit,o=t.dispatch,console.log("🏠 interactWithHouse called"),!n.multiplayer.isMultiplayer||"player"===n.multiplayer.playerRole){e.next=5;break}return console.log("🏠 Not player role, skipping interaction"),e.abrupt("return");case 5:if(i=n.map.indexOf("G",1),s=n.map.indexOf("\n",1)-1,c=Lt(i,s),l=c.x,u=c.y,d=$t(n.map,l,u,s,n.facing),console.log("🏠 House check result:",{house:d,candyHouseIndex:n.candyHouseIndex}),d){e.next=13;break}return console.log("🏠 No interactable house found"),e.abrupt("return");case 13:n.lastInteractedHouseIndex=d.houseIndex,h=Lt(d.houseIndex,s),p=h.x,m=h.y,f=Lt(n.candyHouseIndex,s),v=f.x,y=f.y,g=d.houseIndex===n.candyHouseIndex,console.log("🏠 House comparison:"),console.log("  foundHouseIndex:",d.houseIndex,"at position:",{x:p,y:m}),console.log("  candyHouseIndex:",n.candyHouseIndex,"at position:",{x:v,y:y}),console.log("  isCorrectHouse:",g),console.log("  houseChar:",d.houseChar),console.log("  mapAtFoundIndex:",n.map.charAt(d.houseIndex)),console.log("  mapAtCandyIndex:",n.map.charAt(n.candyHouseIndex)),g?(r("setOverlay",{active:!0,type:"success",message:"Good Job! You got candy!"}),n.score+=1,b=d.houseChar,n.map=It(n.map,d.houseIndex,1,b.toLowerCase()),n.multiplayer.isMultiplayer&&n.multiplayer.webrtcConnected&&(x=a("2b51").default,x.sendGameState({type:"houseInteraction",success:!0,map:n.map,score:n.score,candyHouseIndex:n.candyHouseIndex,activePlayerCharacter:n.multiplayer.activePlayerCharacter})),setTimeout(function(){if(console.log("⏰ 5 seconds elapsed, closing overlay and switching roles"),r("setOverlay",{active:!1,type:null,message:null}),n.multiplayer.isMultiplayer)console.log("🔄 Calling switchRolesAndContinue"),o("switchRolesAndContinue");else{var e=n.map.match(Pt);if(e&&e.length>0)for(var t=Math.floor(Math.random()*e.length),a=0,i=0;i<n.map.length;i++)if(n.map[i].match(Pt)){if(a===t){n.candyHouseIndex=i;break}a++}}},5e3)):(r("setOverlay",{active:!0,type:"fail",message:"Oh no! You got homework!"}),n.score=Math.max(0,n.score-1),n.multiplayer.isMultiplayer&&n.multiplayer.webrtcConnected&&(C=a("2b51").default,C.sendGameState({type:"houseInteraction",success:!1,map:n.map,score:n.score,candyHouseIndex:n.candyHouseIndex,activePlayerCharacter:n.multiplayer.activePlayerCharacter})),setTimeout(function(){r("setOverlay",{active:!1,type:null,message:null})},5e3));case 25:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}});n["a"].use(kt.a,{id:Object({NODE_ENV:"production",BASE_URL:"/trickortreat/"}).VUE_APP_GA||"nope",autoTracking:{exception:!0},debug:{sendHitTask:!0}}),n["a"].config.productionTip=!1,new n["a"]({store:Ut,render:function(e){return e(_t)}}).$mount("#app")},"5c0b":function(e,t,a){"use strict";var n=a("53bd"),r=a.n(n);r.a},"648a":function(e,t,a){},"7e5f":function(e,t,a){"use strict";a.r(t);a("96cf");var n=a("3040"),r=(a("6b54"),a("c665")),o=a("aa9a"),i=(a("cadf"),a("551c"),a("097d"),a("260b")),s=(a("66ce"),{apiKey:"AIzaSyBvAY3gapbiSr2lOrBtge1SeKmHgtLoJ9Y",authDomain:"directions-game.firebaseapp.com",databaseURL:"https://directions-game-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"directions-game",storageBucket:"directions-game.firebasestorage.app",messagingSenderId:"147265691150",appId:"1:147265691150:web:bb58a53271fe7fe831a65f"});i["a"].apps&&i["a"].apps.length||i["a"].initializeApp(s);var c=i["a"].database(),l=(i["a"],function(){function e(){Object(r["a"])(this,e),this.roomRef=null,this.playerId=null,this.roomCode=null,this.ROOM_MAX_AGE_MS=36e5}return Object(o["a"])(e,[{key:"generateRoomCode",value:function(){return Math.floor(1e4+9e4*Math.random()).toString()}},{key:"isRoomCodeTaken",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){var a,n,r,o,i,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=c.ref("rooms/".concat(t)),e.next=3,a.once("value");case 3:if(n=e.sent,n.exists()){e.next=6;break}return e.abrupt("return",!1);case 6:if(r=n.val(),o=Date.now(),i=o-r.createdAt,!(i<this.ROOM_MAX_AGE_MS)){e.next=12;break}return s=r.players&&r.players.player1&&r.players.player1.connected||r.players&&r.players.player2&&r.players.player2.connected,e.abrupt("return",s);case 12:return e.abrupt("return",!1);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cleanupOldRooms",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"createRoom",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){var t,a,n,r,o,i,s,l,u,d,h=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=h.length>0&&void 0!==h[0]?h[0]:"Player 1",a=null,n=0,r=5;case 4:if(a||!(n<r)){e.next=18;break}return o=this.generateRoomCode(),e.next=8,this.isRoomCodeTaken(o);case 8:if(i=e.sent,i){e.next=13;break}a=o,e.next=16;break;case 13:return n++,e.next=16,new Promise(function(e){return setTimeout(e,100)});case 16:e.next=4;break;case 18:if(a){e.next=20;break}throw new Error("Failed to generate unique room code. Please try again.");case 20:return this.roomCode=a,this.playerId="player1",s={roomCode:a,createdAt:Date.now(),players:{player1:{id:"player1",name:t,connected:!0,role:null,character:null,rtcOffer:null,rtcAnswer:null}},gameState:{status:"waiting",currentRound:0,player1Ready:!1,player2Ready:!1}},this.roomRef=c.ref("rooms/".concat(a)),e.next=26,this.roomRef.set(s);case 26:return l=c.ref(".info/connected"),u=this.roomRef.child("players/player1/connected"),d=this.roomRef.child("players/player1/connected").onDisconnect(),d.set(!1),l.on("value",function(e){!0===e.val()&&u.set(!0)}),e.abrupt("return",{roomCode:a,playerId:"player1"});case 32:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"joinRoom",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){var a,n,r,o,i,s,l,u,d,h=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=h.length>1&&void 0!==h[1]?h[1]:"Player 2",this.roomCode=t,this.playerId="player2",this.roomRef=c.ref("rooms/".concat(t)),e.next=6,this.roomRef.once("value");case 6:if(n=e.sent,n.exists()){e.next=9;break}throw new Error("Room not found");case 9:if(r=n.val(),o=Date.now(),r.createdAt){e.next=13;break}throw new Error("Invalid room data");case 13:if(i=o-r.createdAt,!(i>this.ROOM_MAX_AGE_MS)){e.next=18;break}return e.next=17,this.roomRef.remove();case 17:throw new Error("Room has expired. Please ask the host to create a new room.");case 18:if(r.players&&r.players.player1){e.next=20;break}throw new Error("Room is invalid - no host found");case 20:if(r.players.player1.connected){e.next=22;break}throw new Error("Host has disconnected. Please ask them to create a new room.");case 22:if(!r.players.player2){e.next=24;break}throw new Error("Room is full");case 24:if(s=r.gameState&&r.gameState.status,!s||"waiting"===s){e.next=27;break}throw new Error("Game is already in progress. Please wait for the current game to finish.");case 27:return e.next=29,this.roomRef.child("players/player2").set({id:"player2",name:a,connected:!0,role:null,character:null,rtcOffer:null,rtcAnswer:null});case 29:return l=c.ref(".info/connected"),u=this.roomRef.child("players/player2/connected"),d=this.roomRef.child("players/player2/connected").onDisconnect(),d.set(!1),l.on("value",function(e){!0===e.val()&&u.set(!0)}),e.abrupt("return",{roomCode:t,playerId:"player2"});case 35:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onRoomUpdate",value:function(e){this.roomRef&&this.roomRef.on("value",function(t){var a=t.val();a&&e(a)})}},{key:"setRTCOffer",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.roomRef&&this.playerId){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.roomRef.child("players/".concat(this.playerId,"/rtcOffer")).set(t);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setRTCAnswer",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.roomRef&&this.playerId){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.roomRef.child("players/".concat(this.playerId,"/rtcAnswer")).set(t);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addICECandidate",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.roomRef&&this.playerId){e.next=2;break}return e.abrupt("return");case 2:return a=this.roomRef.child("players/".concat(this.playerId,"/iceCandidates")),e.next=5,a.push(t);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateGameState",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.roomRef){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.roomRef.child("gameState").update(t);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"assignRolesAndCharacters",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){var t,a,n,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.roomRef){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.roomRef.once("value");case 4:if(t=e.sent,a=t.val(),a.players.player1&&a.players.player2){e.next=8;break}return e.abrupt("return");case 8:return n=Math.random()<.5?["player","guide"]:["guide","player"],r=Math.random()<.5?["ghost","alien"]:["alien","ghost"],e.next=12,this.roomRef.child("players/player1").update({role:n[0],character:r[0]});case 12:return e.next=14,this.roomRef.child("players/player2").update({role:n[1],character:r[1]});case 14:return e.next=16,this.updateGameState({status:"ready"});case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"switchRoles",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){var t,a,n,r,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.roomRef){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.roomRef.once("value");case 4:return t=e.sent,a=t.val(),n=a.players.player1.role,r=a.players.player2.role,e.next=10,this.roomRef.child("players/player1/role").set(r);case 10:return e.next=12,this.roomRef.child("players/player2/role").set(n);case 12:return o=a.gameState.currentRound||0,e.next=15,this.updateGameState({currentRound:o+1,status:"playing",player1Ready:!1,player2Ready:!1});case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setPlayerReady",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.roomRef&&this.playerId){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.roomRef.child("gameState/".concat(this.playerId,"Ready")).set(!0);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){var t,a,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.roomRef||!this.playerId){e.next=14;break}return e.next=3,this.roomRef.child("players/".concat(this.playerId,"/connected")).set(!1);case 3:if(this.roomRef&&"function"===typeof this.roomRef.off&&this.roomRef.off(),"player1"!==this.playerId){e.next=14;break}return e.next=7,this.roomRef.once("value");case 7:if(t=e.sent,!t.exists()){e.next=14;break}if(a=t.val(),n=a.players&&a.players.player2&&a.players.player2.connected,n){e.next=14;break}return e.next=14,this.roomRef.remove();case 14:this.roomRef=null,this.playerId=null,this.roomCode=null;case 17:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"deleteRoom",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.roomRef||"player1"!==this.playerId){e.next=3;break}return e.next=3,this.roomRef.remove();case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"startPeriodicCleanup",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){var t=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t.length>0&&void 0!==t[0]?t[0]:10;case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}());t["default"]=new l},"7f91":function(e,t,a){},8089:function(e,t,a){"use strict";var n=a("f7e8"),r=a.n(n);r.a},8456:function(e,t,a){},9483:function(e,t,a){},"9cfc":function(e,t,a){"use strict";var n=a("7f91"),r=a.n(n);r.a},a8ab:function(e,t,a){"use strict";var n=a("d5bb"),r=a.n(n);r.a},c434:function(e,t,a){"use strict";var n=a("9483"),r=a.n(n);r.a},d5bb:function(e,t,a){},d804:function(e,t,a){},e202:function(e,t,a){"use strict";var n=a("3587"),r=a.n(n);r.a},e614:function(e,t,a){},e668:function(e,t,a){},f7e8:function(e,t,a){}});
//# sourceMappingURL=app.1e8e0463.js.map